# ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å°å…¥ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Spring Boot ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’å°å…¥ã™ã‚‹ãŸã‚ã®è©³ç´°ãªãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã§ã™ã€‚Clean Architecture / DDD ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ãã€æ®µéšçš„ãªå°å…¥ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

---

## ğŸ“‹ ç¾çŠ¶åˆ†æ

### ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: Spring Boot Backend (Filmsç®¡ç†)
- **é›†ç´„**: `films` (æ˜ ç”»ç®¡ç†)
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: Clean Architecture / DDD
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Spring Boot 4.0.1ã€Java 25
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL (Neon)
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Jakarta Bean Validation
- **ãƒãƒƒãƒ‘ãƒ¼**: MapStruct
- **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«**: Maven

### ç¾åœ¨ã®å•é¡Œç‚¹

1. **ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®æ¬ å¦‚**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„
2. **çµ±ä¸€ã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: Spring Boot ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã•ã‚Œã‚‹
3. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®æœªå‡¦ç†**: Jakarta Bean Validation ã®ã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„
4. **HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä¸é©åˆ‡ãªãƒãƒƒãƒ”ãƒ³ã‚°**: ä¾‹å¤–ã¨ HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¯¾å¿œãŒä¸æ˜ç¢ºï¼ˆ500 ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ï¼‰
5. **æ±ç”¨ä¾‹å¤–ã®ä½¿ç”¨**: `IllegalArgumentException`ã€`IllegalStateException`ãªã©ã‚’ãƒ“ã‚¸ãƒã‚¹ä¾‹å¤–ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§

### ç¾åœ¨ã®ä¾‹å¤–ä½¿ç”¨çŠ¶æ³

- `IllegalArgumentException`: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ï¼ˆValue Object ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ï¼‰
- `IllegalStateException`: ãƒ‰ãƒ¡ã‚¤ãƒ³çŠ¶æ…‹ã‚¨ãƒ©ãƒ¼
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼**: å­˜åœ¨ã—ãªã„
- **ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å˜ä½ã®`@ExceptionHandler`**: å­˜åœ¨ã—ãªã„

### ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®åˆ©ç‚¹

1. **DRY åŸå‰‡**: å„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§åŒã˜ä¾‹å¤–å‡¦ç†ã‚’ç¹°ã‚Šè¿”ã•ãªã„
2. **çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
3. **ä¿å®ˆæ€§ã®å‘ä¸Š**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’ 1 ç®‡æ‰€ã«é›†ç´„
4. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®çµ±ä¸€å‡¦ç†**: `@Valid`ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã‚’è‡ªå‹•çš„ã«å‡¦ç†
5. **HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®é©åˆ‡ãªãƒãƒƒãƒ”ãƒ³ã‚°**: ä¾‹å¤–ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸé©åˆ‡ãª HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”å´

---

## ğŸ¯ ç›®æ¨™

1. **ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®Ÿè£…**: `@ControllerAdvice`ã‚’ä½¿ç”¨ã—ãŸçµ±ä¸€çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
2. **çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**: ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
3. **é©åˆ‡ãª HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°**: RESTful API ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«æº–æ‹ 
4. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®é©åˆ‡ãªå‡¦ç†**: Jakarta Bean Validation ã‚¨ãƒ©ãƒ¼ã®çµ±ä¸€çš„ãªå‡¦ç†
5. **ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã®å®šç¾©**: ãƒ“ã‚¸ãƒã‚¹ä¾‹å¤–ã‚’æ˜ç¢ºã«å®šç¾©ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€æ®µéšçš„å°å…¥ï¼‰
6. **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ”¹å–„**: ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„ãƒ­ã‚°å‡ºåŠ›

---

## ğŸ“ å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Phase 1: å…±é€šã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã®ä½œæˆï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰â­ æœ€åˆã«å®Ÿè£…

**é…ç½®å ´æ‰€**: `common/presentation/response/` ã¾ãŸã¯ `{aggregate}/presentation/response/`

> **è¨­è¨ˆæ–¹é‡**: ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å…±é€šåŒ–ã§ãã‚‹ãŸã‚ã€`common`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«é…ç½®ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚å„é›†ç´„ã”ã¨ã«é…ç½®ã™ã‚‹å ´åˆã¯ã€ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã€å¾Œã§å…±é€šåŒ–ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

#### 1.1 åŸºæœ¬ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¯ãƒ©ã‚¹

**æ¨å¥¨é…ç½®**: `com.example.demo.common.presentation.response.ErrorResponse`

- [ ] `ErrorResponse` ã‚¯ãƒ©ã‚¹ã®ä½œæˆ
  ```java
  package com.example.demo.common.presentation.response;

  import lombok.AllArgsConstructor;
  import lombok.Getter;
  import java.time.LocalDateTime;
  import java.util.Map;

  @Getter
  @AllArgsConstructor
  public class ErrorResponse {
      private LocalDateTime timestamp;
      private int status;
      private String error;
      private String message;
      private String path;
      private Map<String, Object> details; // ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  }
  ```
  - `timestamp`: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚åˆ»
  - `status`: HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
  - `error`: ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ï¼ˆä¾‹: "Bad Request", "Not Found"ï¼‰
  - `message`: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - `path`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹
  - `details`: è©³ç´°æƒ…å ±ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### 1.2 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¯ãƒ©ã‚¹

**æ¨å¥¨é…ç½®**: `com.example.demo.common.presentation.response.ValidationErrorResponse`

- [ ] `ValidationErrorResponse` ã‚¯ãƒ©ã‚¹ã®ä½œæˆ

  ```java
  package com.example.demo.common.presentation.response;

  import lombok.Getter;
  import java.time.LocalDateTime;
  import java.util.List;
  import java.util.Map;

  @Getter
  public class ValidationErrorResponse extends ErrorResponse {
      private final List<FieldError> fieldErrors;
      private final List<String> globalErrors;

      public ValidationErrorResponse(
          LocalDateTime timestamp,
          int status,
          String error,
          String message,
          String path,
          Map<String, Object> details,
          List<FieldError> fieldErrors,
          List<String> globalErrors
      ) {
          super(timestamp, status, error, message, path, details);
          this.fieldErrors = fieldErrors;
          this.globalErrors = globalErrors;
      }
  }
  ```

- [ ] `FieldError` ã‚¯ãƒ©ã‚¹ã®ä½œæˆ
  ```java
  package com.example.demo.common.presentation.response;

  import lombok.AllArgsConstructor;
  import lombok.Getter;

  @Getter
  @AllArgsConstructor
  public class FieldError {
      private String field;
      private Object rejectedValue;
      private String message;
  }
  ```

#### 1.3 ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã®å®šç¾©ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**æ¨å¥¨é…ç½®**: `com.example.demo.common.presentation.response.ErrorCode`

- [ ] `ErrorCode` (enum) - ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã®å®šç¾©
  ```java
  package com.example.demo.common.presentation.response;

  public enum ErrorCode {
      // æ±ç”¨ã‚¨ãƒ©ãƒ¼
      VALIDATION_ERROR,
      INVALID_REQUEST,
      RESOURCE_NOT_FOUND,
      CONFLICT,
      INTERNAL_SERVER_ERROR,

      // é›†ç´„å›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼ï¼ˆä¾‹ï¼‰
      FILM_NOT_FOUND,
      DUPLICATE_FILM_TITLE,
      // ...ä»–ã®é›†ç´„ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
  }
  ```

---

### Phase 2: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®Ÿè£…ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰â­ æ ¸å¿ƒéƒ¨åˆ†

**é…ç½®å ´æ‰€**: `common/presentation/exception/GlobalExceptionHandler`

> **è¨­è¨ˆæ–¹é‡**: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«é©ç”¨ã•ã‚Œã‚‹ãŸã‚ã€`common`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«é…ç½®ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

#### 2.1 ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®åŸºæœ¬å®Ÿè£…

**æ¨å¥¨é…ç½®**: `com.example.demo.common.presentation.exception.GlobalExceptionHandler`

- [ ] `GlobalExceptionHandler` ã‚¯ãƒ©ã‚¹ã®ä½œæˆ
  ```java
  package com.example.demo.common.presentation.exception;

  import com.example.demo.common.presentation.response.ErrorResponse;
  import com.example.demo.common.presentation.response.FieldError;
  import com.example.demo.common.presentation.response.ValidationErrorResponse;
  import jakarta.servlet.http.HttpServletRequest;
  import lombok.RequiredArgsConstructor;
  import lombok.extern.slf4j.Slf4j;
  import org.springframework.http.HttpStatus;
  import org.springframework.http.ResponseEntity;
  import org.springframework.web.bind.MethodArgumentNotValidException;
  import org.springframework.web.bind.annotation.ControllerAdvice;
  import org.springframework.web.bind.annotation.ExceptionHandler;

  import java.time.LocalDateTime;
  import java.util.List;
  import java.util.Map;
  import java.util.stream.Collectors;

  @ControllerAdvice
  @Slf4j
  @RequiredArgsConstructor
  public class GlobalExceptionHandler {

      @ExceptionHandler(MethodArgumentNotValidException.class)
      public ResponseEntity<ValidationErrorResponse> handleValidationException(
          MethodArgumentNotValidException ex, HttpServletRequest request) {
          // å®Ÿè£…
      }

      @ExceptionHandler(IllegalArgumentException.class)
      public ResponseEntity<ErrorResponse> handleIllegalArgumentException(
          IllegalArgumentException ex, HttpServletRequest request) {
          // å®Ÿè£…
      }

      @ExceptionHandler(IllegalStateException.class)
      public ResponseEntity<ErrorResponse> handleIllegalStateException(
          IllegalStateException ex, HttpServletRequest request) {
          // å®Ÿè£…
      }

      @ExceptionHandler(Exception.class)
      public ResponseEntity<ErrorResponse> handleException(
          Exception ex, HttpServletRequest request) {
          // å®Ÿè£…
      }
  }
  ```

#### 2.2 å¿…é ˆä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®Ÿè£…

- [ ] **`handleMethodArgumentNotValidException()`**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

  - `@Valid`ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†
  - `FieldError`ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦`ValidationErrorResponse`ã‚’è¿”å´
  - HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `400 BAD_REQUEST`

- [ ] **`handleConstraintViolationException()`**: ãƒ‘ã‚¹å¤‰æ•°ãƒ»ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

  - `@PathVariable`ã‚„`@RequestParam`ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†
  - HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `400 BAD_REQUEST`

- [ ] **`handleIllegalArgumentException()`**: æ—¢å­˜ã®`IllegalArgumentException`ã®å‡¦ç†

  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šï¼ˆä¾‹: "å¾“æ¥­å“¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" â†’ 404ï¼‰
  - HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `400 BAD_REQUEST`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã€ã¾ãŸã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¿œã˜ã¦å¤‰æ›´

- [ ] **`handleIllegalStateException()`**: æ—¢å­˜ã®`IllegalStateException`ã®å‡¦ç†

  - ãƒ‰ãƒ¡ã‚¤ãƒ³çŠ¶æ…‹ã‚¨ãƒ©ãƒ¼ã‚’å‡¦ç†
  - HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `400 BAD_REQUEST`

- [ ] **`handleException()`**: äºˆæœŸã—ãªã„ä¾‹å¤–ã®å‡¦ç†
  - ã™ã¹ã¦ã®ä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `500 INTERNAL_SERVER_ERROR`
  - ãƒ­ã‚°ã«ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å‡ºåŠ›

#### 2.3 ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…

- [ ] `createErrorResponse()`: `ErrorResponse`ã®ä½œæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
- [ ] `createValidationErrorResponse()`: `ValidationErrorResponse`ã®ä½œæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
- [ ] `getRequestPath()`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹ã®å–å¾—
- [ ] `determineHttpStatus()`: ä¾‹å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åˆ¤å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

### Phase 3: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®è©³ç´°å‡¦ç†ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

#### 3.1 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®è©³ç´°åŒ–

- [ ] `FieldError`ã®è©³ç´°æƒ…å ±ã®è¿½åŠ 
  - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®æ­£è¦åŒ–
  - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å›½éš›åŒ–å¯¾å¿œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### 3.2 ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†

- [ ] Value Object ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

### Phase 4: ãƒ­ã‚°å‡ºåŠ›ã®æ”¹å–„ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

#### 4.1 ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®å®šç¾©

- [ ] ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã”ã¨ã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«
  - `MethodArgumentNotValidException`: `WARN`ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ï¼‰
  - `IllegalArgumentException`: `WARN`ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ï¼‰
  - `IllegalStateException`: `WARN`ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³çŠ¶æ…‹ã‚¨ãƒ©ãƒ¼ï¼‰
  - `Exception` (äºˆæœŸã—ãªã„): `ERROR`ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ï¼‰

#### 4.2 ãƒ­ã‚°å‡ºåŠ›ã®å®Ÿè£…

- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã®ãƒ­ã‚°å‡ºåŠ›
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ã€ãƒ‘ã‚¹ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
  - ä¾‹å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ï¼ˆäºˆæœŸã—ãªã„ä¾‹å¤–ã®ã¿ï¼‰

---

### Phase 5: ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã®å®šç¾©ï¼ˆå„ªå…ˆåº¦: ä½ï¼‰â­ æ®µéšçš„å°å…¥

**é…ç½®å ´æ‰€**: å„é›†ç´„ã®`domain/exception/` ã¾ãŸã¯ `common/domain/exception/`

> **è¨­è¨ˆæ–¹é‡**:
> - **é›†ç´„å›ºæœ‰ã®ä¾‹å¤–**: å„é›†ç´„ã®`{aggregate}/domain/exception/`ã«é…ç½®
> - **å…±é€šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–**: `common/domain/exception/`ã«é…ç½®
> - ä¾‹: `FilmNotFoundException` â†’ `films/domain/exception/`
> - ä¾‹: `ResourceNotFoundException`ï¼ˆæ±ç”¨ï¼‰ â†’ `common/domain/exception/`

#### 5.1 åŸºåº•ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã®ä½œæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**æ¨å¥¨é…ç½®**: `com.example.demo.common.domain.exception.DomainException`

- [ ] `DomainException` (æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹)

  ```java
  package com.example.demo.common.domain.exception;

  import lombok.Getter;
  import org.springframework.http.HttpStatus;

  @Getter
  public abstract class DomainException extends RuntimeException {
      private final HttpStatus httpStatus;
      private final String errorCode;

      protected DomainException(String message, HttpStatus httpStatus, String errorCode) {
          super(message);
          this.httpStatus = httpStatus;
          this.errorCode = errorCode;
      }
  }
  ```

- [ ] `BusinessException` (æŠ½è±¡ã‚¯ãƒ©ã‚¹)
  ```java
  package com.example.demo.common.domain.exception;

  import org.springframework.http.HttpStatus;

  public abstract class BusinessException extends DomainException {
      protected BusinessException(String message, HttpStatus httpStatus, String errorCode) {
          super(message, httpStatus, errorCode);
      }
  }
  ```

#### 5.2 å…·ä½“çš„ãªä¾‹å¤–ã‚¯ãƒ©ã‚¹ã®ä½œæˆä¾‹ï¼ˆFilmsé›†ç´„ï¼‰

**é…ç½®å ´æ‰€**: `com.example.demo.films.domain.exception.{ExceptionName}`

- [ ] `FilmNotFoundException`

  ```java
  package com.example.demo.films.domain.exception;

  import com.example.demo.common.domain.exception.BusinessException;
  import org.springframework.http.HttpStatus;

  public class FilmNotFoundException extends BusinessException {
      public FilmNotFoundException(Long filmId) {
          super(
              "Film not found with ID: " + filmId,
              HttpStatus.NOT_FOUND,
              "FILM_NOT_FOUND"
          );
      }
  }
  ```

- [ ] `DuplicateFilmTitleException`

  ```java
  package com.example.demo.films.domain.exception;

  import com.example.demo.common.domain.exception.BusinessException;
  import org.springframework.http.HttpStatus;

  public class DuplicateFilmTitleException extends BusinessException {
      public DuplicateFilmTitleException(String title) {
          super(
              "Film with title '" + title + "' already exists",
              HttpStatus.CONFLICT,
              "DUPLICATE_FILM_TITLE"
          );
      }
  }
  ```

- [ ] `InvalidFilmStateException`
  ```java
  package com.example.demo.films.domain.exception;

  import com.example.demo.common.domain.exception.BusinessException;
  import org.springframework.http.HttpStatus;

  public class InvalidFilmStateException extends BusinessException {
      public InvalidFilmStateException(String message) {
          super(message, HttpStatus.BAD_REQUEST, "INVALID_FILM_STATE");
      }
  }
  ```

#### 5.3 ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¸ã®è¿½åŠ 

- [ ] `handleDomainException()`: ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã‚’ä¸€æ‹¬å‡¦ç†
  ```java
  @ExceptionHandler(DomainException.class)
  public ResponseEntity<ErrorResponse> handleDomainException(
      DomainException ex, HttpServletRequest request) {
      // ex.getHttpStatus() ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
      // ex.getErrorCode() ã§ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
  }
  ```

#### 5.4 æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç½®ãæ›ãˆï¼ˆæ®µéšçš„ï¼‰

Filmsé›†ç´„ã®ä¾‹:

- [ ] `ListFilmsUseCase` â†’ `FilmNotFoundException`ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
- [ ] `FilmRepository.findById()` â†’ `FilmNotFoundException`
- [ ] ã‚¿ã‚¤ãƒˆãƒ«é‡è¤‡ãƒã‚§ãƒƒã‚¯ â†’ `DuplicateFilmTitleException`
- [ ] `Film`ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯ â†’ `InvalidFilmStateException`

---

---

### Phase 6: ãƒ†ã‚¹ãƒˆã®ä½œæˆï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

#### 6.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

- [ ] ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã®ãƒ†ã‚¹ãƒˆ

#### 6.2 çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ†ã‚¹ãƒˆ
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
- [ ] HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ

---

## ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

### ç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆï¼ˆFilmsé›†ç´„ï¼‰

```
demo/src/main/java/com/example/demo/
â””â”€â”€ films/
    â”œâ”€â”€ application/                    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
    â”‚   â”œâ”€â”€ dto/                        # DTO
    â”‚   â”œâ”€â”€ mapper/                     # MapStructãƒãƒƒãƒ‘ãƒ¼
    â”‚   â””â”€â”€ usecase/                    # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    â”œâ”€â”€ domain/                         # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
    â”‚   â”œâ”€â”€ Film.java                   # é›†ç´„ãƒ«ãƒ¼ãƒˆ
    â”‚   â”œâ”€â”€ FilmRepository.java         # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
    â”‚   â””â”€â”€ vo/                         # Value Object
    â”œâ”€â”€ infrastructure/                 # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
    â”‚   â””â”€â”€ persistence/               # æ°¸ç¶šåŒ–
    â””â”€â”€ presentation/                   # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
        â”œâ”€â”€ controller/                # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
        â””â”€â”€ response/                  # ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTO
            â””â”€â”€ FilmResponse.java
```

### è¿½åŠ ã™ã¹ããƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

#### Phase 1-2: å…±é€šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½œæˆï¼ˆå¿…é ˆï¼‰â­

```
demo/src/main/java/com/example/demo/
â”œâ”€â”€ common/                             # â­ æ–°è¦ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
â”‚   â””â”€â”€ presentation/
â”‚       â”œâ”€â”€ response/                   # ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTO
â”‚       â”‚   â”œâ”€â”€ ErrorResponse.java              # â­ æ–°è¦è¿½åŠ 
â”‚       â”‚   â”œâ”€â”€ ValidationErrorResponse.java    # â­ æ–°è¦è¿½åŠ 
â”‚       â”‚   â”œâ”€â”€ FieldError.java                 # â­ æ–°è¦è¿½åŠ 
â”‚       â”‚   â””â”€â”€ ErrorCode.java                  # â­ æ–°è¦è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”‚       â””â”€â”€ exception/                  # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚           â””â”€â”€ GlobalExceptionHandler.java     # â­ æ–°è¦è¿½åŠ 
â””â”€â”€ films/                              # æ—¢å­˜ã®é›†ç´„
    â””â”€â”€ ...
```

#### Phase 5: ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã®å°å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```
demo/src/main/java/com/example/demo/
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â””â”€â”€ exception/                  # â­ æ–°è¦ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
â”‚   â”‚       â”œâ”€â”€ DomainException.java           # â­ æ–°è¦è¿½åŠ 
â”‚   â”‚       â””â”€â”€ BusinessException.java         # â­ æ–°è¦è¿½åŠ 
â”‚   â””â”€â”€ presentation/
â”‚       â”œâ”€â”€ response/
â”‚       â””â”€â”€ exception/
â”‚           â””â”€â”€ GlobalExceptionHandler.java    # ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¿½åŠ 
â””â”€â”€ films/
    â””â”€â”€ domain/
        â”œâ”€â”€ Film.java
        â”œâ”€â”€ FilmRepository.java
        â”œâ”€â”€ exception/                  # â­ æ–°è¦ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
        â”‚   â”œâ”€â”€ FilmNotFoundException.java          # â­ æ–°è¦è¿½åŠ 
        â”‚   â”œâ”€â”€ DuplicateFilmTitleException.java    # â­ æ–°è¦è¿½åŠ 
        â”‚   â””â”€â”€ InvalidFilmStateException.java      # â­ æ–°è¦è¿½åŠ 
        â””â”€â”€ vo/
```

### å®Œå…¨ãªãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆï¼ˆå®Ÿè£…å¾Œï¼‰

```
demo/src/main/java/com/example/demo/
â”œâ”€â”€ common/                             # â­ å…±é€šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â””â”€â”€ exception/                  # å…±é€šãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–
â”‚   â”‚       â”œâ”€â”€ DomainException.java           # åŸºåº•ä¾‹å¤–
â”‚   â”‚       â””â”€â”€ BusinessException.java         # ãƒ“ã‚¸ãƒã‚¹ä¾‹å¤–åŸºåº•
â”‚   â””â”€â”€ presentation/
â”‚       â”œâ”€â”€ response/                   # ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTO
â”‚       â”‚   â”œâ”€â”€ ErrorResponse.java
â”‚       â”‚   â”œâ”€â”€ ValidationErrorResponse.java
â”‚       â”‚   â”œâ”€â”€ FieldError.java
â”‚       â”‚   â””â”€â”€ ErrorCode.java         # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
â”‚       â””â”€â”€ exception/                  # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚           â””â”€â”€ GlobalExceptionHandler.java
â”‚
â””â”€â”€ films/                              # Filmsé›†ç´„
    â”œâ”€â”€ application/
    â”‚   â”œâ”€â”€ dto/
    â”‚   â”œâ”€â”€ mapper/
    â”‚   â””â”€â”€ usecase/
    â”œâ”€â”€ domain/
    â”‚   â”œâ”€â”€ Film.java
    â”‚   â”œâ”€â”€ FilmRepository.java
    â”‚   â”œâ”€â”€ exception/                  # â­ Filmså›ºæœ‰ã®ä¾‹å¤–
    â”‚   â”‚   â”œâ”€â”€ FilmNotFoundException.java
    â”‚   â”‚   â”œâ”€â”€ DuplicateFilmTitleException.java
    â”‚   â”‚   â””â”€â”€ InvalidFilmStateException.java
    â”‚   â””â”€â”€ vo/
    â”œâ”€â”€ infrastructure/
    â”‚   â””â”€â”€ persistence/
    â””â”€â”€ presentation/
        â”œâ”€â”€ controller/
        â””â”€â”€ response/
            â””â”€â”€ FilmResponse.java
```

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ 

```java
// å…±é€šã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
package com.example.demo.common.presentation.response;

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
package com.example.demo.common.presentation.exception;

// å…±é€šãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
package com.example.demo.common.domain.exception;

// Filmsé›†ç´„ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
package com.example.demo.films.domain.exception;
```

### ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆæ‰‹é †

1. **Phase 1**: `common/presentation/response/`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
2. **Phase 2**: `common/presentation/exception/`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€`GlobalExceptionHandler.java`ã‚’è¿½åŠ 
3. **Phase 5ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**:
   - `common/domain/exception/`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€åŸºåº•ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
   - `films/domain/exception/`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€Filmså›ºæœ‰ã®ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã®è²¬å‹™

#### ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ (`domain/exception/`) - ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- ãƒ“ã‚¸ãƒã‚¹ä¾‹å¤–ã®å®šç¾©
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«é•åã®ä¾‹å¤–
- **é…ç½®**: `domain/exception/`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (`application/exception/`) - é€šå¸¸ã¯ä¸è¦

- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ä¾‹å¤–ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
- ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä½¿ç”¨ã—ãªã„æƒ³å®š

#### ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (`presentation/exception/`, `presentation/response/`)

- **`presentation/exception/`**: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- **`presentation/response/`**: ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO
- HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°
- **é…ç½®**: `presentation/exception/`ã¨`presentation/response/`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

---

## ğŸ“Š HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°

### æ±ç”¨ä¾‹å¤–

| ä¾‹å¤–ã‚¿ã‚¤ãƒ—                        | HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹             | èª¬æ˜                                             |
| --------------------------------- | --------------------------- | ------------------------------------------------ |
| `MethodArgumentNotValidException` | `400 BAD_REQUEST`           | ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼           |
| `ConstraintViolationException`    | `400 BAD_REQUEST`           | ãƒ‘ã‚¹å¤‰æ•°ãƒ»ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ |
| `IllegalArgumentException`        | `400 BAD_REQUEST`           | ç„¡åŠ¹ãªå¼•æ•°ï¼ˆç§»è¡ŒæœŸé–“ç”¨ï¼‰                         |
| `IllegalStateException`           | `400 BAD_REQUEST`           | ç„¡åŠ¹ãªçŠ¶æ…‹ï¼ˆç§»è¡ŒæœŸé–“ç”¨ï¼‰                         |
| `Exception` (äºˆæœŸã—ãªã„)          | `500 INTERNAL_SERVER_ERROR` | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼                                   |

### Filmsé›†ç´„ã®ä¾‹å¤–ï¼ˆPhase 5 å®Ÿè£…å¾Œï¼‰

| ä¾‹å¤–ã‚¿ã‚¤ãƒ—                     | HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜                       |
| ------------------------------ | --------------- | -------------------------- |
| `FilmNotFoundException`        | `404 NOT_FOUND` | æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚‰ãªã„         |
| `DuplicateFilmTitleException`  | `409 CONFLICT`  | ã‚¿ã‚¤ãƒˆãƒ«ã®é‡è¤‡             |
| `InvalidFilmStateException`    | `400 BAD_REQUEST` | ç„¡åŠ¹ãªæ˜ ç”»ã®çŠ¶æ…‹ã§ã®æ“ä½œ |

### ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

```java
// ä¾‹å¤–ã‚¯ãƒ©ã‚¹å†…ã§HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å®šç¾©
public class FilmNotFoundException extends BusinessException {
    public FilmNotFoundException(Long filmId) {
        super(
            "Film not found with ID: " + filmId,
            HttpStatus.NOT_FOUND,  // â† ã“ã“ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å®šç¾©
            "FILM_NOT_FOUND"
        );
    }
}

// GlobalExceptionHandlerã§å–å¾—
@ExceptionHandler(DomainException.class)
public ResponseEntity<ErrorResponse> handleDomainException(
    DomainException ex, HttpServletRequest request) {
    HttpStatus status = ex.getHttpStatus();  // â† ä¾‹å¤–ã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—
    // ...
}
```

---

## ğŸ”„ å®Ÿè£…é †åºã¨ç§»è¡Œè¨ˆç”»

### æœ€å°é™ã®å®Ÿè£…ï¼ˆæ¨å¥¨é–‹å§‹ç‚¹ï¼‰

**Phase 1 â†’ Phase 2 ã®åŸºæœ¬å®Ÿè£…ã®ã¿**ã§ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’å‹•ä½œã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

1. **Phase 1**: `ErrorResponse`ã¨`ValidationErrorResponse`ã‚’ä½œæˆ
2. **Phase 2**: `GlobalExceptionHandler`ã‚’å®Ÿè£…
   - `MethodArgumentNotValidException`ã®å‡¦ç†ï¼ˆå¿…é ˆï¼‰
   - `IllegalArgumentException`ã®å‡¦ç†ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰å¯¾å¿œï¼‰
   - `IllegalStateException`ã®å‡¦ç†ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰å¯¾å¿œï¼‰
   - `Exception`ã®å‡¦ç†ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

ã“ã‚Œã ã‘ã§ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¨æ—¢å­˜ã®ä¾‹å¤–ã‚’çµ±ä¸€çš„ãªå½¢å¼ã§å‡¦ç†ã§ãã¾ã™ã€‚

### æ®µéšçš„ç§»è¡Œ

#### Step 1: åŸºæœ¬å®Ÿè£…ï¼ˆ1-2 æ—¥ï¼‰

- Phase 1: ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã®ä½œæˆ
- Phase 2: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®åŸºæœ¬å®Ÿè£…
- **çµæœ**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¨æ—¢å­˜ä¾‹å¤–ãŒçµ±ä¸€å½¢å¼ã§å‡¦ç†ã•ã‚Œã‚‹

#### Step 2: æ”¹å–„ï¼ˆ1-2 æ—¥ï¼‰

- Phase 3: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®è©³ç´°å‡¦ç†
- Phase 4: ãƒ­ã‚°å‡ºåŠ›ã®æ”¹å–„
- Phase 6: ãƒ†ã‚¹ãƒˆã®ä½œæˆ
- **çµæœ**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒã‚ˆã‚Šå …ç‰¢ã«ãªã‚‹

#### Step 3: ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã®å°å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€1-2 é€±é–“ï¼‰

- Phase 5: ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã®å®šç¾©
- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®æ®µéšçš„ãªç½®ãæ›ãˆ
- **çµæœ**: ã‚ˆã‚Šæ˜ç¢ºãªä¾‹å¤–éšå±¤ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### å¾Œæ–¹äº’æ›æ€§

- ç§»è¡ŒæœŸé–“ä¸­ã¯æ—¢å­˜ã®`IllegalArgumentException`ã¨`IllegalStateException`ã‚‚å‡¦ç†
- ã™ã¹ã¦ã®ä¾‹å¤–ã‚’ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã«ç½®ãæ›ãˆãŸå¾Œã€æ—¢å­˜ä¾‹å¤–ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’å‰Šé™¤ã¾ãŸã¯éæ¨å¥¨åŒ–
- æ—¢å­˜ã® API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®å½±éŸ¿ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹

---

## âœ… å®Œäº†åŸºæº–

### æœ€å°é™ã®å®Ÿè£…å®Œäº†åŸºæº–ï¼ˆPhase 1-2ï¼‰

- [ ] `common/presentation/response/ErrorResponse`ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `common/presentation/response/ValidationErrorResponse`ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `common/presentation/response/FieldError`ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `common/presentation/exception/GlobalExceptionHandler`ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] `MethodArgumentNotValidException`ãŒå‡¦ç†ã•ã‚Œã¦ã„ã‚‹
- [ ] `IllegalArgumentException`ãŒå‡¦ç†ã•ã‚Œã¦ã„ã‚‹
- [ ] `IllegalStateException`ãŒå‡¦ç†ã•ã‚Œã¦ã„ã‚‹
- [ ] `Exception`ï¼ˆäºˆæœŸã—ãªã„ä¾‹å¤–ï¼‰ãŒå‡¦ç†ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒçµ±ä¸€ã•ã‚ŒãŸå½¢å¼ã«ãªã£ã¦ã„ã‚‹
- [ ] HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé©åˆ‡ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹
- [ ] Filmsé›†ç´„ã®æ—¢å­˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå‹•ä½œã—ã¦ã„ã‚‹

### å®Œå…¨ãªå®Ÿè£…å®Œäº†åŸºæº–ï¼ˆPhase 3-6ï¼‰

- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒè©³ç´°ã«å‡¦ç†ã•ã‚Œã¦ã„ã‚‹ï¼ˆPhase 3ï¼‰
- [ ] ãƒ­ã‚°å‡ºåŠ›ãŒæ”¹å–„ã•ã‚Œã¦ã„ã‚‹ï¼ˆPhase 4ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ï¼ˆPhase 6ï¼‰
  - [ ] `GlobalExceptionHandler`ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
  - [ ] å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] `common/domain/exception/DomainException`ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ï¼ˆPhase 5ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] `common/domain/exception/BusinessException`ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ï¼ˆPhase 5ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] Filmsé›†ç´„ã®ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ï¼ˆPhase 5ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - [ ] `FilmNotFoundException`
  - [ ] `DuplicateFilmTitleException`
  - [ ] `InvalidFilmStateException`
- [ ] ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ï¼ˆPhase 5ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] æ—¢å­˜ã®ãƒ“ã‚¸ãƒã‚¹ä¾‹å¤–ãŒã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã‚‹ï¼ˆPhase 5ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Spring Boot Error Handling](https://spring.io/guides/gs/rest-service/)
- [Spring @ControllerAdvice Documentation](https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-advice.html)
- [RESTful API Design - Error Handling](https://restfulapi.net/error-handling-rest-api/)
- [Jakarta Bean Validation](https://beanvalidation.org/)
- [Clean Architecture - Error Handling](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

## ğŸ’¡ å®Ÿè£…ã®ãƒ’ãƒ³ãƒˆ

### `@ControllerAdvice`ã®å‹•ä½œç¯„å›²

- `@ControllerAdvice`ã¯ã™ã¹ã¦ã®`@Controller`ã¨`@RestController`ã«é©ç”¨ã•ã‚Œã‚‹
- `basePackages`å±æ€§ã§ç‰¹å®šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã¿ã«é©ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½
  ```java
  @ControllerAdvice(basePackages = "com.example.demo")
  public class GlobalExceptionHandler {
      // ...
  }
  ```
- `assignableTypes`å±æ€§ã§ç‰¹å®šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ã®ã¿ã«é©ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½

### ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å„ªå…ˆé †ä½

1. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å†…ã®`@ExceptionHandler`ï¼ˆæœ€ã‚‚å„ªå…ˆï¼‰
2. `@ControllerAdvice`ã®`@ExceptionHandler`
3. Spring Boot ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼

### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å½¢å¼

RESTful API ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã„ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã‚ã‚‹ï¼š

- `timestamp`: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚åˆ»ï¼ˆISO 8601å½¢å¼æ¨å¥¨ï¼‰
- `status`: HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
- `error`: ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ï¼ˆçŸ­ã„èª¬æ˜ï¼‰
- `message`: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆè©³ç´°ï¼‰
- `path`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹
- `details`: è¿½åŠ æƒ…å ±ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "timestamp": "2025-12-27T10:30:00",
  "status": 404,
  "error": "Not Found",
  "message": "Film not found with ID: 123",
  "path": "/api/films/123"
}
```

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### æ¨å¥¨å®Ÿè£…é †åº

1. **Phase 1 ã‚’å®Œäº†ã™ã‚‹**: `common/presentation/response/`ã«åŸºæœ¬ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ
2. **Phase 2 ã‚’å®Œäº†ã™ã‚‹**: `common/presentation/exception/GlobalExceptionHandler`ã‚’å®Ÿè£…
3. **å‹•ä½œç¢ºèª**: Filmsé›†ç´„ã®æ—¢å­˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ãƒ†ã‚¹ãƒˆ
4. **Phase 3-4 ã‚’æ¤œè¨**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°åŒ–ã¨ãƒ­ã‚°æ”¹å–„
5. **Phase 5 ã‚’æ¤œè¨**: ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã®å°å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### ã™ãã«å§‹ã‚ã‚‰ã‚Œã‚‹æœ€åˆã®ä¸€æ­©

```bash
# 1. commonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œæˆ
mkdir -p demo/src/main/java/com/example/demo/common/presentation/response
mkdir -p demo/src/main/java/com/example/demo/common/presentation/exception

# 2. ErrorResponse.javaã‚’ä½œæˆ
# ï¼ˆPhase 1-1 ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ï¼‰

# 3. ValidationErrorResponse.javaã¨FieldError.javaã‚’ä½œæˆ
# ï¼ˆPhase 1-2 ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ï¼‰

# 4. GlobalExceptionHandler.javaã‚’ä½œæˆ
# ï¼ˆPhase 2-1 ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ï¼‰

# 5. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¦å‹•ä½œç¢ºèª
mvn spring-boot:run
```

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ä»–ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚å‚ç…§ã—ã¦ãã ã•ã„:

- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ.md](./ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ.md) - å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®èª¬æ˜
- [ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤.md](./ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ/ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤.md) - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®è©³ç´°
- [ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md](./ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ/ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md) - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…
- [ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md](./ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ/ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md) - ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®å®Ÿè£…
- [ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤.md](./ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ/ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤.md) - ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®å®Ÿè£…
