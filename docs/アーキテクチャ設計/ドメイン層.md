# ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤

## ğŸ“Œ æ¦‚è¦

ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¸­å¿ƒã«ä½ç½®ã™ã‚‹æœ€ã‚‚é‡è¦ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã™ã€‚
ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰ã‚’è¡¨ç¾ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ¬è³ªçš„ãªä¾¡å€¤ã‚’æä¾›ã—ã¾ã™ã€‚

### ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®å½¹å‰²

- **ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®è¡¨ç¾**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ ¸ã¨ãªã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
- **å®Œå…¨ãªç‹¬ç«‹æ€§**: ä»–ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆUIã€DBã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼‰ã«ä¸€åˆ‡ä¾å­˜ã—ãªã„
- **æ°¸ç¶šåŒ–ã®æŠ½è±¡åŒ–**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’é€šã˜ã¦è¡Œã†
- **æŠ€è¡“çš„é–¢å¿ƒã®æ’é™¤**: JPA ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã®æŠ€è¡“çš„è©³ç´°ã‚’å«ã¾ãªã„

---

## ğŸ—ï¸ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®æ§‹æˆ

```
domain/
  â”” {aggregate}/                â† é›†ç´„ã”ã¨ã«ãƒ•ã‚©ãƒ«ãƒ€åˆ†ã‘
      â”œ {Aggregate}.java            â† é›†ç´„ãƒ«ãƒ¼ãƒˆ
      â”œ {Aggregate}Id.java          â† è­˜åˆ¥å­ï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
      â”œ {Property}.java             â† ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
      â”œ {Aggregate}Repository.java  â† ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
      â”” {Aggregate}DomainService.java â† ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```

**ä¾‹: Film é›†ç´„ã®å ´åˆ**

```
domain/
  â”” film/
      â”œ Film.java                   â† é›†ç´„ãƒ«ãƒ¼ãƒˆ
      â”œ FilmId.java                 â† è­˜åˆ¥å­
      â”œ FilmTitle.java              â† ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
      â”œ FilmDescription.java        â† èª¬æ˜ï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
      â”œ FilmReleaseYear.java        â† å…¬é–‹å¹´ï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
      â”” FilmRepository.java         â† ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
```

---

## ğŸ¯ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®æ§‹æˆè¦ç´ 

### 1. é›†ç´„ãƒ«ãƒ¼ãƒˆï¼ˆAggregate Rootï¼‰

é›†ç´„ãƒ«ãƒ¼ãƒˆã¯ã€é–¢é€£ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¾¤ï¼ˆé›†ç´„ï¼‰ã®å¢ƒç•Œã‚’å®šç¾©ã—ã€å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã™ã€‚

#### å½¹å‰²

- **é›†ç´„ã®å¢ƒç•Œå®šç¾©**: é›†ç´„å†…ã®ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡
- **ä¸å¤‰æ¡ä»¶ã®ä¿è­·**: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®æ•´åˆæ€§ã‚’ç¶­æŒ
- **ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†**: é›†ç´„å†…ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆãƒ»å‰Šé™¤ã‚’ç®¡ç†

#### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

```java
@Getter
@NoArgsConstructor(access = AccessLevel.PRIVATE)  // privateã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
public class {Aggregate} {
    // è­˜åˆ¥å­
    private {Aggregate}Id id;

    // å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    private {Property1} property1;
    private {Property2} property2;

    /**
     * æ–°è¦ä½œæˆç”¨ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
     */
    public static {Aggregate} create({Aggregate}Id id, {Property1} prop1, {Property2} prop2) {
        {Aggregate} aggregate = new {Aggregate}();
        aggregate.id = id;
        aggregate.property1 = prop1;
        aggregate.property2 = prop2;
        // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®æ¤œè¨¼
        return aggregate;
    }

    /**
     * å†æ§‹æˆç”¨ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆDBå–å¾—æ™‚ï¼‰
     */
    public static {Aggregate} reconstruct({Aggregate}Id id, {Property1} prop1, {Property2} prop2) {
        {Aggregate} aggregate = new {Aggregate}();
        aggregate.id = id;
        aggregate.property1 = prop1;
        aggregate.property2 = prop2;
        return aggregate;
    }

    /**
     * ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
     */
    public void updateProperty({Property1} newValue) {
        // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®æ¤œè¨¼
        this.property1 = newValue;
    }
}
```

#### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

1. **private ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿**

   - å¤–éƒ¨ã‹ã‚‰ç›´æ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã§ããªã„ã‚ˆã†ã«ã™ã‚‹
   - ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é€šã˜ã¦ã®ã¿ç”Ÿæˆå¯èƒ½
   - ç”Ÿæˆæ™‚ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’å¼·åˆ¶

2. **ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰**

   - `create()`: æ–°è¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆæ™‚ã«ä½¿ç”¨
   - `reconstruct()`: DB ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã™ã‚‹éš›ã«ä½¿ç”¨
   - ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–

3. **å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½¿ç”¨**

   - ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã§ã¯ãªãã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ä¸å¤‰æ€§ã‚’ä¿è¨¼
   - ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã®æ˜ç¤ºåŒ–

4. **JPA ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãªã—**

   - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¯æ°¸ç¶šåŒ–æŠ€è¡“ã«ä¾å­˜ã—ãªã„
   - ç´”ç²‹ãª Java ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆPOJOï¼‰
   - ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“

5. **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–**
   - `updateProperty()`ã®ã‚ˆã†ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’æŒã¤ãƒ¡ã‚½ãƒƒãƒ‰
   - ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿è¨¼
   - ã‚»ãƒƒã‚¿ãƒ¼ã®ä»£ã‚ã‚Šã«æ„å›³ã‚’è¡¨ã™ãƒ¡ã‚½ãƒƒãƒ‰å

---

### 2. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆValue Objectï¼‰

å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€è­˜åˆ¥å­ã‚’æŒãŸãšã€å€¤ãã®ã‚‚ã®ã§åŒä¸€æ€§ã‚’åˆ¤æ–­ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

#### ç‰¹å¾´

1. **ä¸å¤‰æ€§ï¼ˆImmutableï¼‰**

   - `final`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
   - setter ãªã—
   - å¤‰æ›´ã™ã‚‹å ´åˆã¯æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ

2. **è‡ªå·±ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**

   - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
   - ä¸æ­£ãªå€¤ã‚’æŒã¤ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯å­˜åœ¨ã§ããªã„
   - å¸¸ã«æœ‰åŠ¹ãªçŠ¶æ…‹ã‚’ä¿è¨¼

3. **ç­‰ä¾¡æ€§ã®å®Ÿè£…**
   - `@EqualsAndHashCode`ã§å€¤ã«ã‚ˆã‚‹æ¯”è¼ƒã‚’å®Ÿè£…
   - åŒã˜å€¤ã‚’æŒã¤ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ç­‰ã—ã„
   - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åŒä¸€æ€§ã§ã¯ãªãã€å€¤ã®ç­‰ä¾¡æ€§

#### åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

##### è­˜åˆ¥å­ï¼ˆIDï¼‰

```java
@Getter
@ToString
@EqualsAndHashCode
public class {Aggregate}Id {
    private final Long value;

    public {Aggregate}Id(Long value) {
        if (value == null) {
            throw new IllegalArgumentException("{Aggregate}Id must not be null");
        }
        this.value = value;
    }
}
```

**å½¹å‰²**:

- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä¸€æ„ã«è­˜åˆ¥
- ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã‚’ãƒ©ãƒƒãƒ—ã—ã¦å‹å®‰å…¨æ€§ã‚’ç¢ºä¿

**ãƒ¡ãƒªãƒƒãƒˆ**:

- å‹å®‰å…¨æ€§: `UserId`ã¨`FilmId`ã‚’æ··åŒã§ããªã„
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: ä¸æ­£ãª ID ã®ç”Ÿæˆã‚’é˜²ã
- ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã®è¡¨ç¾

##### æ–‡å­—åˆ—ãƒ™ãƒ¼ã‚¹ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```java
@Getter
@EqualsAndHashCode
public class {Property} {
    private final String value;

    public {Property}(String value) {
        // null/ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯
        if (value == null || value.trim().isEmpty()) {
            throw new IllegalArgumentException("{Property} must not be null or empty");
        }

        // æ–‡å­—æ•°åˆ¶é™ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        if (value.length() > 255) {
            throw new IllegalArgumentException("{Property} is too long");
        }

        // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        // if (!value.matches("æ­£è¦è¡¨ç¾")) {
        //     throw new IllegalArgumentException("Invalid {Property} format");
        // }

        this.value = value;
    }
}
```

##### æ•°å€¤ãƒ™ãƒ¼ã‚¹ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```java
@Getter
@ToString
@EqualsAndHashCode
public class {Property} {
    private final Integer value;

    public {Property}(Integer value) {
        // null ãƒã‚§ãƒƒã‚¯
        if (value == null) {
            throw new IllegalArgumentException("{Property} must not be null");
        }

        // ç¯„å›²ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        if (value < 0) {
            throw new IllegalArgumentException("{Property} must be positive");
        }

        this.value = value;
    }
}
```

##### åˆ—æŒ™å‹ãƒ™ãƒ¼ã‚¹ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```java
public enum {Status} {
    ACTIVE("æœ‰åŠ¹"),
    INACTIVE("ç„¡åŠ¹"),
    PENDING("ä¿ç•™ä¸­");

    private final String displayName;

    {Status}(String displayName) {
        this.displayName = displayName;
    }

    public String getDisplayName() {
        return displayName;
    }
}
```

#### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

```java
public class Email {
    private final String value;

    public Email(String value) {
        // 1. null/ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯
        if (value == null || value.trim().isEmpty()) {
            throw new IllegalArgumentException("Email must not be null or empty");
        }

        // 2. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼
        if (!value.matches("^[A-Za-z0-9+_.-]+@(.+)$")) {
            throw new IllegalArgumentException("Invalid email format");
        }

        // 3. æ­£è¦åŒ–ï¼ˆå°æ–‡å­—åŒ–ãªã©ï¼‰
        this.value = value.toLowerCase();
    }
}
```

---

### 3. ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆRepository Interfaceï¼‰

ãƒªãƒã‚¸ãƒˆãƒªã¯ã€é›†ç´„ã®æ°¸ç¶šåŒ–ã¨ã‚¯ã‚¨ãƒªã‚’æŠ½è±¡åŒ–ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™ã€‚

#### åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```java
/**
 * {Aggregate}ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼‰
 * å®Ÿè£…ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã«é…ç½®
 */
public interface {Aggregate}Repository {

    /**
     * é›†ç´„ã‚’ä¿å­˜ï¼ˆæ–°è¦ä½œæˆãƒ»æ›´æ–°ï¼‰
     */
    {Aggregate} save({Aggregate} aggregate);

    /**
     * é›†ç´„ã‚’å‰Šé™¤
     */
    void delete({Aggregate} aggregate);

    /**
     * IDã§é›†ç´„ã‚’æ¤œç´¢
     */
    Optional<{Aggregate}> findById({Aggregate}Id id);

    /**
     * ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§æ¤œç´¢
     */
    Optional<{Aggregate}> findBy{Property}({Property} property);

    /**
     * å…¨é›†ç´„ã‚’å–å¾—
     */
    List<{Aggregate}> findAll();

    /**
     * å­˜åœ¨ç¢ºèª
     */
    boolean existsBy{Property}({Property} property);

    /**
     * æ¬¡ã®IDã‚’ç”Ÿæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
     */
    {Aggregate}Id nextIdentity();
}
```

#### è¨­è¨ˆåŸå‰‡

1. **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã¿**

   - å®Ÿè£…ã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã«é…ç½®
   - ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼ˆDIPï¼‰ã‚’é©ç”¨
   - ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯å®Ÿè£…ã«ä¾å­˜ã—ãªã„

2. **ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ‰±ã†**

   - å¼•æ•°ãƒ»æˆ»ã‚Šå€¤ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
   - JpaEntity ãªã©ã®æŠ€è¡“çš„è©³ç´°ã¯å«ã¾ãªã„
   - å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ã£ãŸå‹å®‰å…¨ãªæ¤œç´¢

3. **ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼**

   - `save()`: ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½åŠ /æ›´æ–°
   - `delete()`: ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å‰Šé™¤
   - `findById()`: ID ã§æ¤œç´¢
   - `findAll()`: ã™ã¹ã¦å–å¾—

4. **é›†ç´„å˜ä½ã§ã®ã‚¢ã‚¯ã‚»ã‚¹**
   - ãƒªãƒã‚¸ãƒˆãƒªã¯é›†ç´„ãƒ«ãƒ¼ãƒˆå˜ä½ã§ä½œæˆ
   - é›†ç´„ã®å†…éƒ¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ãªã„

---

### 4. ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆDomain Serviceï¼‰

è¤‡æ•°ã®é›†ç´„ã«ã¾ãŸãŒã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚„ã€ç‰¹å®šã®é›†ç´„ã«å±ã•ãªã„ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

#### ã„ã¤ä½¿ç”¨ã™ã‚‹ã‹

- è¤‡æ•°ã®é›†ç´„ã‚’æ“ä½œã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã©ã®é›†ç´„ã«ã‚‚å±ã•ãªã„ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æºï¼ˆæŠ½è±¡åŒ–ã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ï¼‰

#### åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```java
@Component
public class {Aggregate}DomainService {

    /**
     * è¤‡æ•°é›†ç´„ã«ã¾ãŸãŒã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
     */
    public boolean isDuplicate({Property} property, {Aggregate}Repository repository) {
        return repository.existsByProperty(property);
    }

    /**
     * è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
     */
    public {Result} calculateSomething({Aggregate} aggregate1, {Aggregate} aggregate2) {
        // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
        return result;
    }
}
```

---

## ğŸ” ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®è¨­è¨ˆåŸå‰‡

### 1. æŠ€è¡“çš„é–¢å¿ƒã®åˆ†é›¢

âŒ **æ‚ªã„ä¾‹**: JPA ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ··åœ¨

```java
@Entity
@Table(name = "aggregates")
public class Aggregate {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String name;
}
```

âœ… **è‰¯ã„ä¾‹**: ç´”ç²‹ãªãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«

```java
@Getter
@NoArgsConstructor(access = AccessLevel.PRIVATE)
public class Aggregate {
    private AggregateId id;
    private AggregateName name;
}
```

---

### 2. ä¸å¤‰æ€§ã®é‡è¦–

âŒ **æ‚ªã„ä¾‹**: setter ã«ã‚ˆã‚‹çŠ¶æ…‹å¤‰æ›´

```java
public class Property {
    private String value;

    public void setValue(String value) {
        this.value = value;  // ä¸å¤‰æ€§ãŒä¿è¨¼ã•ã‚Œãªã„
    }
}
```

âœ… **è‰¯ã„ä¾‹**: ä¸å¤‰ãªå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```java
@Getter
@EqualsAndHashCode
public class Property {
    private final String value;

    public Property(String value) {
        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«è¨­å®š
        this.value = value;
    }
}
```

---

### 3. è‡ªå·±ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

âŒ **æ‚ªã„ä¾‹**: å¤–éƒ¨ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```java
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§æ¤œè¨¼
if (name == null || name.isEmpty()) {
    throw new Exception("Invalid name");
}
Aggregate aggregate = new Aggregate(name);
```

âœ… **è‰¯ã„ä¾‹**: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ¤œè¨¼

```java
public class AggregateName {
    public AggregateName(String value) {
        if (value == null || value.trim().isEmpty()) {
            throw new IllegalArgumentException("AggregateName must not be null or empty");
        }
        this.value = value;
    }
}
```

---

### 4. ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã®å›é¿

âŒ **æ‚ªã„ä¾‹**: ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã®ä½¿ç”¨

```java
public class Aggregate {
    private Long id;
    private String name;
    private Integer year;
}
```

âœ… **è‰¯ã„ä¾‹**: å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½¿ç”¨

```java
public class Aggregate {
    private AggregateId id;
    private AggregateName name;
    private Year year;
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:

- å‹å®‰å…¨æ€§ãŒå‘ä¸Šï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å‹ãƒã‚§ãƒƒã‚¯ï¼‰
- ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ãŒã‚³ãƒ¼ãƒ‰ã«è¡¨ç¾ã•ã‚Œã‚‹
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸€ç®‡æ‰€ã«é›†ç´„
- ID ã®æ··åŒã‚’é˜²ã

---

## ğŸ“ ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆï¼ˆDDDï¼‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³

**ç›®çš„**: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–

**ä½¿ã„åˆ†ã‘**:

- `create()`: æ–°è¦ä½œæˆæ™‚ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰
- `reconstruct()`: æ°¸ç¶šåŒ–ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®å¾©å…ƒï¼ˆãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰

---

### 2. é›†ç´„ãƒ‘ã‚¿ãƒ¼ãƒ³

**åŸå‰‡**: é›†ç´„ã®å¢ƒç•Œã‚’è¶Šãˆã‚‹æ“ä½œã¯é›†ç´„ãƒ«ãƒ¼ãƒˆã‚’çµŒç”±ã™ã‚‹

```java
// âœ… æ­£ã—ã„: é›†ç´„ãƒ«ãƒ¼ãƒˆã‚’é€šã˜ã¦ã‚¢ã‚¯ã‚»ã‚¹
Aggregate aggregate = repository.findById(id);
aggregate.updateProperty(newValue);

// âŒ é–“é•ã„: é›†ç´„ã®å†…éƒ¨ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹
Property property = aggregate.getProperty();
property.setValue("new value");  // ãã‚‚ãã‚‚setterãŒãªã„
```

---

### 3. ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³

**ç›®çš„**: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°å±¤ã®åˆ†é›¢

```java
// ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
public interface AggregateRepository {
    Aggregate save(Aggregate aggregate);
    Optional<Aggregate> findById(AggregateId id);
}

// ã‚¤ãƒ³ãƒ•ãƒ©å±¤: å®Ÿè£…
@Repository
public class AggregateRepositoryImpl implements AggregateRepository {
    // JPAã€MyBatisç­‰ã‚’ä½¿ã£ãŸå®Ÿè£…
}
```

---

## ğŸ“Š ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ¡ãƒªãƒƒãƒˆ

### 1. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®é›†ä¸­åŒ–

- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒä¸€ç®‡æ‰€ã«é›†ç´„
- é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®å‰Šæ¸›
- å¤‰æ›´ç®‡æ‰€ã®æ˜ç¢ºåŒ–

### 2. ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š

```java
@Test
void testPropertyValidation() {
    // ãƒ¢ãƒƒã‚¯ä¸è¦ã€ç´”ç²‹ãªãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
    assertThrows(IllegalArgumentException.class,
        () -> new Property(""));

    assertThrows(IllegalArgumentException.class,
        () -> new Property(null));

    Property property = new Property("Valid Value");
    assertEquals("Valid Value", property.getValue());
}
```

### 3. æŠ€è¡“çš„è² å‚µã®è»½æ¸›

- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¤‰æ›´æ™‚ã®å½±éŸ¿ãŒæœ€å°é™
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´æ™‚ã‚‚ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯ä¸å¤‰
- UI å¤‰æ›´æ™‚ã‚‚ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯å½±éŸ¿ã‚’å—ã‘ãªã„

### 4. ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã®æ˜ç¤ºåŒ–

ã‚³ãƒ¼ãƒ‰ãŒãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰ã‚’è¡¨ç¾:

```java
// ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã ã‘ã§ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒç†è§£ã§ãã‚‹
public class Email {
    public Email(String value) {
        if (!value.matches("^[A-Za-z0-9+_.-]+@(.+)$")) {
            throw new IllegalArgumentException("Invalid email format");
        }
        this.value = value.toLowerCase();  // æ­£è¦åŒ–
    }
}
```

---

## ğŸš€ å®Ÿè·µçš„ãªãƒ’ãƒ³ãƒˆ

### ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®æˆé•·

1. **æœ€åˆã¯ã‚·ãƒ³ãƒ—ãƒ«ã«**

   ```java
   // åˆæœŸ: åŸºæœ¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿
   if (value == null) {
       throw new IllegalArgumentException("must not be null");
   }
   ```

2. **ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®è¿½åŠ **

   ```java
   // æˆé•·: ã‚ˆã‚Šè©³ç´°ãªãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ 
   if (value.length() > 255) {
       throw new IllegalArgumentException("Too long");
   }
   if (!value.matches("[a-zA-Z0-9 ]+")) {
       throw new IllegalArgumentException("Invalid characters");
   }
   ```

3. **ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã®å°å…¥**
   ```java
   // è¤‡æ•°é›†ç´„ã«ã¾ãŸãŒã‚‹ãƒ­ã‚¸ãƒƒã‚¯
   public class DomainService {
       public boolean isDuplicate(Property property, Repository repository) {
           return repository.existsByProperty(property);
       }
   }
   ```

---

## ğŸ“ ã¾ã¨ã‚

### ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

âœ… **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸­å¿ƒ**

- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾¡å€¤ã‚’è¡¨ç¾
- æŠ€è¡“çš„è©³ç´°ã‹ã‚‰ç‹¬ç«‹

âœ… **ä¸å¤‰æ€§ã¨è‡ªå·±ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**

- å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸å¤‰
- ä¸æ­£ãªçŠ¶æ…‹ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å­˜åœ¨ã§ããªã„

âœ… **å‹å®‰å…¨æ€§**

- ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã®ä»£ã‚ã‚Šã«å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡º

âœ… **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**

- ãƒ¢ãƒƒã‚¯ä¸è¦ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼ãŒå®¹æ˜“

âœ… **ä¿å®ˆæ€§**

- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®å¤‰æ›´ãŒå®¹æ˜“
- å½±éŸ¿ç¯„å›²ãŒé™å®šçš„
- ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ãŒã‚³ãƒ¼ãƒ‰ã«è¡¨ç¾ã•ã‚Œã‚‹

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ.md](../ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ.md) - å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®èª¬æ˜
- [ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md](./ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md) - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…
- [ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤.md](./ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤.md) - ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…ã®è©³ç´°
