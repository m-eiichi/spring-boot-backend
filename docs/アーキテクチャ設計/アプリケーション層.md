# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤

## ğŸ“Œ æ¦‚è¦

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã¯ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã™ã€‚
ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’çµ„ã¿åˆã‚ã›ã¦ã€å…·ä½“çš„ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®å½¹å‰²

- **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†**: ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿è¨¼ã™ã‚‹å¢ƒç•Œã‚’å®šç¾©
- **DTO å¤‰æ›**: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨å¤–éƒ¨ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›
- **ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: è¤‡æ•°ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã‚„ãƒªãƒã‚¸ãƒˆãƒªã‚’èª¿æ•´

---

## ğŸ—ï¸ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®æ§‹æˆ

```
application/
  â”” {aggregate}/                â† é›†ç´„ã”ã¨ã«ãƒ•ã‚©ãƒ«ãƒ€åˆ†ã‘
      â”œ usecase/                    â† ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
      â”‚   â”œ Create{Aggregate}UseCase.java
      â”‚   â”œ Get{Aggregate}UseCase.java
      â”‚   â”œ List{Aggregate}sUseCase.java
      â”‚   â”œ Update{Aggregate}UseCase.java
      â”‚   â”” Delete{Aggregate}UseCase.java
      â”œ dto/                        â† ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
      â”‚   â”” {Aggregate}DTO.java
      â”” mapper/                     â† ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†” DTO å¤‰æ›
          â”” {Aggregate}ApplicationMapper.java
```

**ä¾‹: Film é›†ç´„ã®å ´åˆ**

```
application/
  â”” films/
      â”œ usecase/
      â”‚   â”œ CreateFilmUseCase.java
      â”‚   â”œ GetFilmUseCase.java
      â”‚   â”œ ListFilmsUseCase.java
      â”‚   â”œ UpdateFilmUseCase.java
      â”‚   â”” DeleteFilmUseCase.java
      â”œ dto/
      â”‚   â”” FilmDTO.java
      â”” mapper/
          â”” FilmApplicationMapper.java
```

---

## ğŸ¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®æ§‹æˆè¦ç´ 

### 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆUse Caseï¼‰

ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

#### åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```java
@Service
@Transactional
@RequiredArgsConstructor
public class {Operation}{Aggregate}UseCase {

    private final {Aggregate}Repository repository;
    private final {Aggregate}ApplicationMapper mapper;
    // å¿…è¦ã«å¿œã˜ã¦ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªã‚„ã‚µãƒ¼ãƒ“ã‚¹

    /**
     * ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
     */
    public {Result}DTO execute({Parameter}DTO input) {
        // 1. å…¥åŠ›ã®æ¤œè¨¼ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

        // 2. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›

        // 3. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œ

        // 4. æ°¸ç¶šåŒ–

        // 5. çµæœã‚’DTOã«å¤‰æ›ã—ã¦è¿”å´
    }
}
```

#### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

1. **@Service ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - Spring ã®ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ç™»éŒ²
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ã“ã¨ã‚’æ˜ç¤º

2. **@Transactional ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã‚’å®šç¾©
   - èª­ã¿å–ã‚Šå°‚ç”¨ã®å ´åˆã¯ `@Transactional(readOnly = true)`

3. **@RequiredArgsConstructorï¼ˆLombokï¼‰**
   - final ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¼•æ•°ã¨ã™ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è‡ªå‹•ç”Ÿæˆ
   - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç°¡æ½”ã«è¨˜è¿°

4. **å˜ä¸€è²¬ä»»ã®åŸå‰‡**
   - 1 ã¤ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ã¯ 1 ã¤ã®æ“ä½œã®ã¿ã‚’å®Ÿè£…
   - è¤‡æ•°ã®æ“ä½œã‚’ 1 ã¤ã®ã‚¯ãƒ©ã‚¹ã«ã¾ã¨ã‚ãªã„

---

#### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ç¨®é¡

##### (1) ä½œæˆï¼ˆCreateï¼‰

```java
@Service
@Transactional
@RequiredArgsConstructor
public class Create{Aggregate}UseCase {

    private final {Aggregate}Repository repository;

    public {Aggregate}DTO execute(Create{Aggregate}Request request) {
        // 1. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å«ã‚€ï¼‰
        {Property1} prop1 = new {Property1}(request.getProperty1());
        {Property2} prop2 = new {Property2}(request.getProperty2());

        // 2. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®ç”Ÿæˆ
        {Aggregate} aggregate = {Aggregate}.create(
            repository.nextIdentity(),
            prop1,
            prop2
        );

        // 3. æ°¸ç¶šåŒ–
        {Aggregate} saved = repository.save(aggregate);

        // 4. DTOã«å¤‰æ›ã—ã¦è¿”å´
        return mapper.toDTO(saved);
    }
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ `create()` ã‚’ä½¿ç”¨
- å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- ãƒªãƒã‚¸ãƒˆãƒªã§æ°¸ç¶šåŒ–å¾Œã€DTO ã«å¤‰æ›

---

##### (2) å–å¾—ï¼ˆGetï¼‰

```java
@Service
@Transactional(readOnly = true)  // èª­ã¿å–ã‚Šå°‚ç”¨
@RequiredArgsConstructor
public class Get{Aggregate}UseCase {

    private final {Aggregate}Repository repository;
    private final {Aggregate}ApplicationMapper mapper;

    public {Aggregate}DTO execute(Long id) {
        // 1. IDã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒ–
        {Aggregate}Id aggregateId = new {Aggregate}Id(id);

        // 2. ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å–å¾—
        {Aggregate} aggregate = repository.findById(aggregateId)
            .orElseThrow(() -> new NotFoundException(
                "{Aggregate} not found: " + id));

        // 3. DTOã«å¤‰æ›ã—ã¦è¿”å´
        return mapper.toDTO(aggregate);
    }
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `@Transactional(readOnly = true)` ã§èª­ã¿å–ã‚Šå°‚ç”¨ã‚’æ˜ç¤º
- ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼
- Optional ã‹ã‚‰å€¤ã‚’å–ã‚Šå‡ºã™éš›ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

##### (3) ä¸€è¦§å–å¾—ï¼ˆListï¼‰

```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class List{Aggregate}sUseCase {

    private final {Aggregate}Repository repository;
    private final {Aggregate}ApplicationMapper mapper;

    /**
     * å…¨ä»¶å–å¾—
     */
    public List<{Aggregate}DTO> execute() {
        return mapper.toDTOList(repository.findAll());
    }

    /**
     * æ¡ä»¶ä»˜ãå–å¾—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
     */
    public List<{Aggregate}DTO> executeBy{Condition}({Condition} condition) {
        return mapper.toDTOList(
            repository.findBy{Condition}(condition)
        );
    }
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- ãƒªã‚¹ãƒˆã®å¤‰æ›ã«ã¯ãƒãƒƒãƒ‘ãƒ¼ã® `toDTOList()` ã‚’ä½¿ç”¨
- æ¡ä»¶ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿ã‚‚åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

---

##### (4) æ›´æ–°ï¼ˆUpdateï¼‰

```java
@Service
@Transactional
@RequiredArgsConstructor
public class Update{Aggregate}UseCase {

    private final {Aggregate}Repository repository;
    private final {Aggregate}ApplicationMapper mapper;

    public {Aggregate}DTO execute(Long id, Update{Aggregate}Request request) {
        // 1. æ—¢å­˜ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å–å¾—
        {Aggregate}Id aggregateId = new {Aggregate}Id(id);
        {Aggregate} aggregate = repository.findById(aggregateId)
            .orElseThrow(() -> new NotFoundException(
                "{Aggregate} not found: " + id));

        // 2. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
        {Property} newProperty = new {Property}(request.getProperty());

        // 3. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
        aggregate.updateProperty(newProperty);

        // 4. æ°¸ç¶šåŒ–
        {Aggregate} updated = repository.save(aggregate);

        // 5. DTOã«å¤‰æ›ã—ã¦è¿”å´
        return mapper.toDTO(updated);
    }
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‹ã‚‰æ›´æ–°
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ`updateProperty()`ï¼‰ã‚’ä½¿ç”¨
- setter ã§ã¯ãªããƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ãƒ¡ã‚½ãƒƒãƒ‰ã§æ›´æ–°

---

##### (5) å‰Šé™¤ï¼ˆDeleteï¼‰

```java
@Service
@Transactional
@RequiredArgsConstructor
public class Delete{Aggregate}UseCase {

    private final {Aggregate}Repository repository;

    public void execute(Long id) {
        // 1. IDã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒ–
        {Aggregate}Id aggregateId = new {Aggregate}Id(id);

        // 2. æ—¢å­˜ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å–å¾—
        {Aggregate} aggregate = repository.findById(aggregateId)
            .orElseThrow(() -> new NotFoundException(
                "{Aggregate} not found: " + id));

        // 3. å‰Šé™¤å‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        // if (!aggregate.canDelete()) {
        //     throw new BusinessException("Cannot delete {aggregate}");
        // }

        // 4. å‰Šé™¤
        repository.delete(aggregate);
    }
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- å‰Šé™¤å‰ã«å­˜åœ¨ç¢ºèª
- å‰Šé™¤å¯èƒ½ã‹ã©ã†ã‹ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
- æˆ»ã‚Šå€¤ã¯ voidï¼ˆå‰Šé™¤æˆåŠŸã‚’ç¤ºã™ï¼‰

---

### 2. DTOï¼ˆData Transfer Objectï¼‰

DTO ã¯ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã™ã‚‹ãŸã‚ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

#### åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class {Aggregate}DTO {
    // ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã‚„æ¨™æº–ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
    private Long id;
    private String property1;
    private String property2;
    private Integer property3;

    // é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯åˆ¥ã®DTOã¨ã—ã¦è¡¨ç¾ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
    // private RelatedDTO related;
}
```

#### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã®ä½¿ç”¨**
   - å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãªãã€ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã‚„æ¨™æº–ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
   - JSON ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãŒå®¹æ˜“

2. **getter/setter ã®æä¾›**
   - `@Data` ã§è‡ªå‹•ç”Ÿæˆ
   - ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã®é€£æºãŒå®¹æ˜“

3. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯å«ã¾ãªã„**
   - DTO è‡ªä½“ã«ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã¾ãªã„
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å®Ÿæ–½

4. **ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨åˆ†é›¢**
   - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®æ§‹é€ ã«ä¾å­˜ã—ãªã„
   - å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹å½¢å¼ã‚’è‡ªç”±ã«è¨­è¨ˆå¯èƒ½

---

#### DTO ã®ç¨®é¡

##### (1) å‡ºåŠ› DTOï¼ˆResponse DTOï¼‰

```java
/**
 * {Aggregate}ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTO
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class {Aggregate}DTO {
    private Long id;
    private String name;
    private String description;
    private Integer value;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

**ç”¨é€”**: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‹ã‚‰ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã¸ã®å‡ºåŠ›

---

##### (2) å…¥åŠ› DTOï¼ˆRequest DTOï¼‰

```java
/**
 * {Aggregate}ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆDTO
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Create{Aggregate}Request {
    private String name;
    private String description;
    private Integer value;
}

/**
 * {Aggregate}æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆDTO
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Update{Aggregate}Request {
    private String name;
    private String description;
    private Integer value;
}
```

**ç”¨é€”**: ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‹ã‚‰ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¸ã®å…¥åŠ›

**ãƒã‚¤ãƒ³ãƒˆ**:
- ä½œæˆã¨æ›´æ–°ã§åˆ¥ã® DTO ã‚’ä½¿ç”¨ï¼ˆå¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç•°ãªã‚‹å ´åˆï¼‰
- ID ã¯å«ã¾ãªã„ï¼ˆURL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¸¡ã•ã‚Œã‚‹ï¼‰

---

### 3. ãƒãƒƒãƒ‘ãƒ¼ï¼ˆMapperï¼‰

ãƒãƒƒãƒ‘ãƒ¼ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ DTO ã®ç›¸äº’å¤‰æ›ã‚’è¡Œã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

#### MapStruct ã‚’ä½¿ç”¨ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³

```java
/**
 * ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†” DTO ã®å¤‰æ›ï¼ˆMapStructä½¿ç”¨ï¼‰
 */
@Mapper(componentModel = "spring")
public interface {Aggregate}ApplicationMapper {

    /**
     * ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†’ DTO
     */
    @Mapping(source = "id.value", target = "id")
    @Mapping(source = "property1.value", target = "property1")
    @Mapping(source = "property2.value", target = "property2")
    {Aggregate}DTO toDTO({Aggregate} aggregate);

    /**
     * ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ãƒªã‚¹ãƒˆ â†’ DTOãƒªã‚¹ãƒˆ
     */
    List<{Aggregate}DTO> toDTOList(List<{Aggregate}> aggregates);

    /**
     * DTO â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼šé€šå¸¸ã¯å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æ§‹ç¯‰ï¼‰
     */
    @Mapping(target = "id", ignore = true)  // IDã¯åˆ¥é€”è¨­å®š
    {Aggregate} toAggregate({Aggregate}DTO dto);
}
```

#### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

1. **@Mapper ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - `componentModel = "spring"` ã§ Spring Bean ã¨ã—ã¦ç™»éŒ²
   - MapStruct ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å®Ÿè£…ã‚’è‡ªå‹•ç”Ÿæˆ

2. **@Mapping ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã® `value` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã«ãƒãƒƒãƒ”ãƒ³ã‚°
   - ãƒã‚¹ãƒˆã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š

3. **ãƒªã‚¹ãƒˆå¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰**
   - å˜ä¸€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒã‚ã‚Œã°ã€ãƒªã‚¹ãƒˆã‚‚è‡ªå‹•å¯¾å¿œ
   - ãƒ¡ã‚½ãƒƒãƒ‰ã‚·ã‚°ãƒãƒãƒ£ã®ã¿å®šç¾©ã™ã‚Œã° OK

4. **é€†å¤‰æ›ã¯æ…é‡ã«**
   - DTO â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›ã¯é€šå¸¸ä¸è¦
   - å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ç›´æ¥ç”Ÿæˆã™ã‚‹æ–¹ãŒå®‰å…¨

---

#### æ‰‹å‹•ãƒãƒƒãƒ‘ãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆMapStruct æœªä½¿ç”¨ï¼‰

```java
@Component
public class {Aggregate}ApplicationMapper {

    /**
     * ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†’ DTO
     */
    public {Aggregate}DTO toDTO({Aggregate} aggregate) {
        if (aggregate == null) {
            return null;
        }

        return new {Aggregate}DTO(
            aggregate.getId().getValue(),
            aggregate.getProperty1().getValue(),
            aggregate.getProperty2().getValue()
        );
    }

    /**
     * ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ãƒªã‚¹ãƒˆ â†’ DTOãƒªã‚¹ãƒˆ
     */
    public List<{Aggregate}DTO> toDTOList(List<{Aggregate}> aggregates) {
        return aggregates.stream()
            .map(this::toDTO)
            .collect(Collectors.toList());
    }
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- MapStruct ãŒä½¿ãˆãªã„å ´åˆã®ä»£æ›¿æ‰‹æ®µ
- null ãƒã‚§ãƒƒã‚¯ã‚’å¿˜ã‚Œãšã«
- Stream API ã§ãƒªã‚¹ãƒˆå¤‰æ›

---

## ğŸ” ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®è¨­è¨ˆåŸå‰‡

### 1. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã®æ˜ç¢ºåŒ–

âœ… **è‰¯ã„ä¾‹**: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å˜ä½ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³

```java
@Service
@Transactional  // ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å…¨ä½“ã‚’ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åŒ–
@RequiredArgsConstructor
public class CreateOrderUseCase {
    public OrderDTO execute(CreateOrderRequest request) {
        // ã™ã¹ã¦ã®å‡¦ç†ãŒ1ã¤ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…
    }
}
```

âŒ **æ‚ªã„ä¾‹**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸æ˜ç¢ºãªå¢ƒç•Œ

```java
@Service  // @Transactional ãªã—
public class OrderService {
    public void process() {
        // ã©ã“ãŒãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã‹ä¸æ˜
    }
}
```

---

### 2. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¸ã®ä¾å­˜

âœ… **è‰¯ã„ä¾‹**: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨

```java
@Service
@Transactional
public class UseCase {
    private final AggregateRepository repository;  // ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤

    public void execute() {
        Aggregate aggregate = repository.findById(id);
        aggregate.updateProperty(value);  // ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ¡ã‚½ãƒƒãƒ‰ä½¿ç”¨
    }
}
```

âŒ **æ‚ªã„ä¾‹**: ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã«ç›´æ¥ä¾å­˜

```java
@Service
public class UseCase {
    private final JpaRepository jpaRepo;  // ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã«ç›´æ¥ä¾å­˜

    public void execute() {
        Entity entity = jpaRepo.findById(id);
        entity.setProperty(value);  // setterä½¿ç”¨
    }
}
```

---

### 3. ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã¸ã®éä¾å­˜

âœ… **è‰¯ã„ä¾‹**: DTO ã‚’è¿”å´

```java
@Service
public class UseCase {
    public AggregateDTO execute() {
        Aggregate aggregate = repository.findById(id);
        return mapper.toDTO(aggregate);  // DTOè¿”å´
    }
}
```

âŒ **æ‚ªã„ä¾‹**: HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç›´æ¥æ‰±ã†

```java
@Service
public class UseCase {
    public ResponseEntity<Object> execute() {  // ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®æ¦‚å¿µ
        // ...
        return ResponseEntity.ok(aggregate);
    }
}
```

---

### 4. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å˜ä¸€è²¬ä»»

âœ… **è‰¯ã„ä¾‹**: 1 ã‚¯ãƒ©ã‚¹ 1 ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

```java
// ä½œæˆå°‚ç”¨
public class CreateAggregateUseCase {
    public AggregateDTO execute(CreateRequest request) { }
}

// æ›´æ–°å°‚ç”¨
public class UpdateAggregateUseCase {
    public AggregateDTO execute(Long id, UpdateRequest request) { }
}
```

âŒ **æ‚ªã„ä¾‹**: è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ 1 ã‚¯ãƒ©ã‚¹ã«

```java
public class AggregateService {
    public AggregateDTO create() { }
    public AggregateDTO update() { }
    public void delete() { }
    public AggregateDTO get() { }
    // è²¬å‹™ãŒå¤šã™ãã‚‹
}
```

---

## ğŸ“ å®Ÿè·µçš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. è¤‡æ•°ãƒªãƒã‚¸ãƒˆãƒªã®åˆ©ç”¨

```java
@Service
@Transactional
@RequiredArgsConstructor
public class CreateOrderUseCase {

    private final OrderRepository orderRepository;
    private final ProductRepository productRepository;  // åˆ¥ã®é›†ç´„
    private final CustomerRepository customerRepository;  // åˆ¥ã®é›†ç´„

    public OrderDTO execute(CreateOrderRequest request) {
        // 1. é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å–å¾—
        Customer customer = customerRepository.findById(request.getCustomerId())
            .orElseThrow(() -> new NotFoundException("Customer not found"));

        // 2. å•†å“ã®åœ¨åº«ãƒã‚§ãƒƒã‚¯
        Product product = productRepository.findById(request.getProductId())
            .orElseThrow(() -> new NotFoundException("Product not found"));

        if (!product.hasStock(request.getQuantity())) {
            throw new BusinessException("Insufficient stock");
        }

        // 3. æ³¨æ–‡ã®ä½œæˆ
        Order order = Order.create(
            orderRepository.nextIdentity(),
            customer.getId(),
            product.getId(),
            new Quantity(request.getQuantity())
        );

        // 4. æ°¸ç¶šåŒ–
        Order saved = orderRepository.save(order);

        return mapper.toDTO(saved);
    }
}
```

---

### 2. ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨

```java
@Service
@Transactional
@RequiredArgsConstructor
public class RegisterUserUseCase {

    private final UserRepository userRepository;
    private final UserDomainService userDomainService;  // ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹

    public UserDTO execute(RegisterUserRequest request) {
        // 1. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
        Email email = new Email(request.getEmail());

        // 2. ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã§é‡è¤‡ãƒã‚§ãƒƒã‚¯
        if (userDomainService.isDuplicateEmail(email, userRepository)) {
            throw new BusinessException("Email already exists");
        }

        // 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        User user = User.create(
            userRepository.nextIdentity(),
            new UserName(request.getName()),
            email
        );

        // 4. æ°¸ç¶šåŒ–
        User saved = userRepository.save(user);

        return mapper.toDTO(saved);
    }
}
```

---

### 3. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ

```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class ListAggregatesUseCase {

    private final AggregateRepository repository;
    private final AggregateApplicationMapper mapper;

    /**
     * ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãä¸€è¦§å–å¾—
     */
    public Page<AggregateDTO> execute(int page, int size) {
        Pageable pageable = PageRequest.of(page, size);
        Page<Aggregate> aggregatesPage = repository.findAll(pageable);

        return aggregatesPage.map(mapper::toDTO);
    }

    /**
     * æ¡ä»¶ä»˜ããƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
     */
    public Page<AggregateDTO> executeByCondition(
        Condition condition,
        int page,
        int size
    ) {
        Pageable pageable = PageRequest.of(page, size);
        Page<Aggregate> aggregatesPage =
            repository.findByCondition(condition, pageable);

        return aggregatesPage.map(mapper::toDTO);
    }
}
```

---

## ğŸ“Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ãƒ¡ãƒªãƒƒãƒˆ

### 1. ãƒ“ã‚¸ãƒã‚¹ãƒ•ãƒ­ãƒ¼ã®æ˜ç¢ºåŒ–

- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å˜ä½ã§å‡¦ç†ãƒ•ãƒ­ãƒ¼ãŒåˆ†é›¢
- å„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒä½•ã‚’ã™ã‚‹ã‹ãŒæ˜ç¢º
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„ä¿å®ˆãŒå®¹æ˜“

### 2. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ã®ä¸€å…ƒåŒ–

- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•ŒãŒæ˜ç¢º
- ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿è¨¼
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®åˆ¶å¾¡ãŒå®¹æ˜“

### 3. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®å†åˆ©ç”¨æ€§

- åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§åˆ©ç”¨
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¦ã‚‚å½±éŸ¿ãŒå±€æ‰€åŒ–
- ãƒ†ã‚¹ãƒˆãŒæ›¸ãã‚„ã™ã„

### 4. ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã®ç–çµåˆ

- ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‹ã‚‰åˆ†é›¢
- ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®å®Ÿè£…è©³ç´°ã‹ã‚‰åˆ†é›¢
- å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ãŒé™å®šçš„

---

## ğŸš€ å®Ÿè·µçš„ãªãƒ’ãƒ³ãƒˆ

### 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹åã®å‘½åè¦å‰‡

```java
// âœ… å‹•è© + åè© + UseCase
CreateOrderUseCase
GetUserUseCase
ListProductsUseCase
UpdateCustomerUseCase
DeleteInvoiceUseCase

// âŒ æ›–æ˜§ãªå‘½å
OrderService
UserManager
ProductHandler
```

### 2. ä¾‹å¤–å‡¦ç†ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

```java
@Service
@Transactional
@RequiredArgsConstructor
public class GetAggregateUseCase {

    public AggregateDTO execute(Long id) {
        AggregateId aggregateId = new AggregateId(id);

        // ãƒ“ã‚¸ãƒã‚¹ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§å‡¦ç†ï¼‰
        return repository.findById(aggregateId)
            .map(mapper::toDTO)
            .orElseThrow(() -> new NotFoundException(
                "Aggregate not found: " + id
            ));
    }
}
```

### 3. DTO ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®ä½¿ã„åˆ†ã‘

```java
// âŒ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ç›´æ¥è¿”ã™
public Film execute() {
    return repository.findById(id);  // NG
}

// âœ… DTOã«å¤‰æ›ã—ã¦è¿”ã™
public FilmDTO execute() {
    Film film = repository.findById(id);
    return mapper.toDTO(film);  // OK
}
```

---

## ğŸ“ ã¾ã¨ã‚

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

âœ… **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…**

- 1 ã‚¯ãƒ©ã‚¹ 1 ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®åŸå‰‡
- ãƒ“ã‚¸ãƒã‚¹ãƒ•ãƒ­ãƒ¼ã®æ˜ç¢ºåŒ–

âœ… **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†**

- `@Transactional` ã§å¢ƒç•Œã‚’æ˜ç¢ºã«
- èª­ã¿å–ã‚Šå°‚ç”¨ã¯ `readOnly = true`

âœ… **DTO ã®æ´»ç”¨**

- ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã®ãƒ‡ãƒ¼ã‚¿è»¢é€
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨åˆ†é›¢

âœ… **ãƒãƒƒãƒ‘ãƒ¼ã®åˆ©ç”¨**

- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†” DTO ã®å¤‰æ›
- MapStruct ã§è‡ªå‹•ç”Ÿæˆ

âœ… **ä¾å­˜é–¢ä¿‚ã®æ–¹å‘**

- ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ä¾å­˜
- ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã«ã¯éä¾å­˜

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ.md](../ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ.md) - å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®èª¬æ˜
- [ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤.md](./ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤.md) - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®è©³ç´°
- [ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md](./ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md) - ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®å®Ÿè£…
- [ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤.md](./ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤.md) - ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…ã®è©³ç´°
