# ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤

## ğŸ“Œ æ¦‚è¦

ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã¯ã€å¤–éƒ¨ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã™ã€‚
HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å®Ÿè¡Œã—ã€HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã—ã¾ã™ã€‚

### ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®å½¹å‰²

- **HTTP ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æä¾›**: REST API ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©
- **ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä»˜**: HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã«æ¸¡ã™
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®çµæœã‚’ HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¤‰æ›
- **å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ã‚’æ¤œè¨¼
- **ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ãª HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›

---

## ğŸ—ï¸ ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®æ§‹æˆ

```
presentation/
  â”” {aggregate}/                â† é›†ç´„ã”ã¨ã«ãƒ•ã‚©ãƒ«ãƒ€åˆ†ã‘
      â”œ controller/                 â† ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
      â”‚   â”” {Aggregate}Controller.java
      â”œ request/                    â† ãƒªã‚¯ã‚¨ã‚¹ãƒˆ DTO
      â”‚   â”œ Create{Aggregate}Request.java
      â”‚   â”” Update{Aggregate}Request.java
      â”œ response/                   â† ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO
      â”‚   â”” {Aggregate}Response.java
      â”” mapper/                     â† DTO å¤‰æ›ãƒãƒƒãƒ‘ãƒ¼
          â”” {Aggregate}PresentationMapper.java
```

**ä¾‹: Film é›†ç´„ã®å ´åˆ**

```
presentation/
  â”” films/
      â”œ controller/
      â”‚   â”” FilmsController.java
      â”œ request/
      â”‚   â”œ CreateFilmRequest.java
      â”‚   â”” UpdateFilmRequest.java
      â”œ response/
      â”‚   â”” FilmResponse.java
      â”” mapper/
          â”” FilmPresentationMapper.java
```

---

## ğŸ¯ ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®æ§‹æˆè¦ç´ 

### 1. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆControllerï¼‰

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯ã€HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å®Ÿè¡Œã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

#### åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```java
@RestController
@RequestMapping("/api/{aggregates}")
@RequiredArgsConstructor
public class {Aggregate}Controller {

    private final Create{Aggregate}UseCase createUseCase;
    private final Get{Aggregate}UseCase getUseCase;
    private final List{Aggregate}sUseCase listUseCase;
    private final Update{Aggregate}UseCase updateUseCase;
    private final Delete{Aggregate}UseCase deleteUseCase;
    private final {Aggregate}PresentationMapper mapper;

    // ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
}
```

#### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

1. **@RestController ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - `@Controller` + `@ResponseBody` ã®çµ„ã¿åˆã‚ã›
   - JSON ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è‡ªå‹•çš„ã«è¿”å´
   - REST API ã«ç‰¹åŒ–ã—ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼

2. **@RequestMapping ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - ãƒ™ãƒ¼ã‚¹ URL ã‚’å®šç¾©ï¼ˆä¾‹: `/api/films`ï¼‰
   - ã‚¯ãƒ©ã‚¹ãƒ¬ãƒ™ãƒ«ã§æŒ‡å®š
   - å„ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ‘ã‚¹ã¯ã“ã‚Œã«è¿½åŠ ã•ã‚Œã‚‹

3. **@RequiredArgsConstructorï¼ˆLombokï¼‰**
   - final ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è‡ªå‹•ç”Ÿæˆ
   - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç°¡æ½”ã«è¨˜è¿°

4. **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®æ³¨å…¥**
   - å„æ“ä½œï¼ˆCRUDï¼‰ã”ã¨ã«å°‚ç”¨ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’æ³¨å…¥
   - å˜ä¸€è²¬ä»»ã®åŸå‰‡ã«å¾“ã†

---

#### REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç¨®é¡

##### (1) ä½œæˆï¼ˆPOSTï¼‰

```java
/**
 * æ–°è¦ä½œæˆ
 * POST /api/{aggregates}
 */
@PostMapping
public ResponseEntity<{Aggregate}Response> create(
    @RequestBody @Valid Create{Aggregate}Request request
) {
    // 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
    {Aggregate}DTO dto = createUseCase.execute(request);

    // 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã«å¤‰æ›
    {Aggregate}Response response = mapper.toResponse(dto);

    // 3. HTTP 201 Created ã§è¿”å´
    return ResponseEntity
        .created(URI.create("/api/{aggregates}/" + dto.getId()))
        .body(response);
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `@PostMapping`: POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†
- `@RequestBody`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ Java ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
- `@Valid`: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- `ResponseEntity.created()`: 201 Created ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- `Location` ãƒ˜ãƒƒãƒ€ãƒ¼ã«ä½œæˆã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã® URL ã‚’è¨­å®š

---

##### (2) å–å¾—ï¼ˆGET - å˜ä¸€ï¼‰

```java
/**
 * ID ã§å–å¾—
 * GET /api/{aggregates}/{id}
 */
@GetMapping("/{id}")
public ResponseEntity<{Aggregate}Response> getById(
    @PathVariable Long id
) {
    // 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
    {Aggregate}DTO dto = getUseCase.execute(id);

    // 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã«å¤‰æ›
    {Aggregate}Response response = mapper.toResponse(dto);

    // 3. HTTP 200 OK ã§è¿”å´
    return ResponseEntity.ok(response);
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `@GetMapping("/{id}")`: GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆ + ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- `@PathVariable`: URL ã®ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
- `ResponseEntity.ok()`: 200 OK ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

---

##### (3) ä¸€è¦§å–å¾—ï¼ˆGET - è¤‡æ•°ï¼‰

```java
/**
 * ä¸€è¦§å–å¾—
 * GET /api/{aggregates}
 */
@GetMapping
public ResponseEntity<List<{Aggregate}Response>> getAll(
    @RequestParam(required = false) String filter,
    @RequestParam(required = false, defaultValue = "0") int page,
    @RequestParam(required = false, defaultValue = "20") int size
) {
    // 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
    List<{Aggregate}DTO> dtos = listUseCase.execute(filter, page, size);

    // 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã®ãƒªã‚¹ãƒˆã«å¤‰æ›
    List<{Aggregate}Response> responses = mapper.toResponseList(dtos);

    // 3. HTTP 200 OK ã§è¿”å´
    return ResponseEntity.ok(responses);
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `@RequestParam`: ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
- `required = false`: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- `defaultValue`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®æŒ‡å®š
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚µãƒãƒ¼ãƒˆ

---

##### (4) ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œã®ä¸€è¦§å–å¾—

```java
/**
 * ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãä¸€è¦§å–å¾—
 * GET /api/{aggregates}?page=0&size=20
 */
@GetMapping
public ResponseEntity<Page<{Aggregate}Response>> getAll(
    @RequestParam(required = false, defaultValue = "0") int page,
    @RequestParam(required = false, defaultValue = "20") int size,
    @RequestParam(required = false) String sortBy
) {
    // 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œï¼ˆPageã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ï¼‰
    Page<{Aggregate}DTO> dtoPage = listUseCase.execute(page, size, sortBy);

    // 2. Page<DTO> ã‚’ Page<Response> ã«å¤‰æ›
    Page<{Aggregate}Response> responsePage = dtoPage.map(mapper::toResponse);

    // 3. HTTP 200 OK ã§è¿”å´
    return ResponseEntity.ok(responsePage);
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `Page<T>`: Spring Data ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å‹
- `map()`: ãƒšãƒ¼ã‚¸å†…ã®å„è¦ç´ ã‚’å¤‰æ›
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆç·ä»¶æ•°ã€ç·ãƒšãƒ¼ã‚¸æ•°ãªã©ï¼‰ã‚‚å«ã¾ã‚Œã‚‹

---

##### (5) æ›´æ–°ï¼ˆPUTï¼‰

```java
/**
 * æ›´æ–°
 * PUT /api/{aggregates}/{id}
 */
@PutMapping("/{id}")
public ResponseEntity<{Aggregate}Response> update(
    @PathVariable Long id,
    @RequestBody @Valid Update{Aggregate}Request request
) {
    // 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
    {Aggregate}DTO dto = updateUseCase.execute(id, request);

    // 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã«å¤‰æ›
    {Aggregate}Response response = mapper.toResponse(dto);

    // 3. HTTP 200 OK ã§è¿”å´
    return ResponseEntity.ok(response);
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `@PutMapping("/{id}")`: PUT ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ä¸¡æ–¹ã‚’å—ã‘å–ã‚‹
- å…¨ä½“æ›´æ–°ï¼ˆå…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒ‡å®šï¼‰

---

##### (6) éƒ¨åˆ†æ›´æ–°ï¼ˆPATCHï¼‰

```java
/**
 * éƒ¨åˆ†æ›´æ–°
 * PATCH /api/{aggregates}/{id}
 */
@PatchMapping("/{id}")
public ResponseEntity<{Aggregate}Response> partialUpdate(
    @PathVariable Long id,
    @RequestBody Patch{Aggregate}Request request
) {
    // 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
    {Aggregate}DTO dto = patchUseCase.execute(id, request);

    // 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã«å¤‰æ›
    {Aggregate}Response response = mapper.toResponse(dto);

    // 3. HTTP 200 OK ã§è¿”å´
    return ResponseEntity.ok(response);
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `@PatchMapping`: PATCH ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- ä¸€éƒ¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æ›´æ–°
- Request DTO ã§ã¯å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã«

---

##### (7) å‰Šé™¤ï¼ˆDELETEï¼‰

```java
/**
 * å‰Šé™¤
 * DELETE /api/{aggregates}/{id}
 */
@DeleteMapping("/{id}")
public ResponseEntity<Void> delete(
    @PathVariable Long id
) {
    // 1. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
    deleteUseCase.execute(id);

    // 2. HTTP 204 No Content ã§è¿”å´
    return ResponseEntity.noContent().build();
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `@DeleteMapping("/{id}")`: DELETE ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- `ResponseEntity<Void>`: ãƒœãƒ‡ã‚£ãªã—
- `ResponseEntity.noContent()`: 204 No Content ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

---

### 2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆ DTOï¼ˆRequest DTOï¼‰

ãƒªã‚¯ã‚¨ã‚¹ãƒˆ DTO ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®å…¥åŠ›ã‚’å—ã‘å–ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

#### åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```java
/**
 * {Aggregate} ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Create{Aggregate}Request {

    @NotNull(message = "Property1 is required")
    @Size(min = 1, max = 100, message = "Property1 must be between 1 and 100 characters")
    private String property1;

    @NotNull(message = "Property2 is required")
    @Size(min = 1, max = 255, message = "Property2 must be between 1 and 255 characters")
    private String property2;

    @NotNull(message = "Property3 is required")
    @Min(value = 0, message = "Property3 must be at least 0")
    private Integer property3;
}
```

#### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

##### å…±é€šãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```java
// null ãƒã‚§ãƒƒã‚¯
@NotNull(message = "Field is required")
private String field;

// ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ï¼ˆnull ã‚‚ NGï¼‰
@NotBlank(message = "Field must not be blank")
private String field;

// ç©ºãƒã‚§ãƒƒã‚¯ï¼ˆnull ã‚‚ NGã€Collection/Array ã«ä½¿ç”¨ï¼‰
@NotEmpty(message = "Field must not be empty")
private List<String> field;
```

##### æ–‡å­—åˆ—ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```java
// æ–‡å­—æ•°åˆ¶é™
@Size(min = 1, max = 100, message = "Field must be between 1 and 100 characters")
private String field;

// ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
@Pattern(regexp = "^[A-Za-z0-9]+$", message = "Field must be alphanumeric")
private String field;

// ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
@Email(message = "Invalid email format")
private String email;
```

##### æ•°å€¤ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```java
// æœ€å°å€¤
@Min(value = 0, message = "Field must be at least 0")
private Integer field;

// æœ€å¤§å€¤
@Max(value = 100, message = "Field must be at most 100")
private Integer field;

// ç¯„å›²æŒ‡å®š
@Min(0) @Max(100)
private Integer field;

// æ­£ã®æ•°
@Positive(message = "Field must be positive")
private Integer field;

// è² ã§ãªã„æ•°
@PositiveOrZero(message = "Field must be positive or zero")
private Integer field;
```

##### æ—¥ä»˜ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```java
// éå»ã®æ—¥ä»˜
@Past(message = "Field must be in the past")
private LocalDate field;

// æœªæ¥ã®æ—¥ä»˜
@Future(message = "Field must be in the future")
private LocalDate field;
```

---

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ DTO ã®ç¨®é¡

##### (1) ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Create{Aggregate}Request {
    @NotBlank
    private String name;

    @NotBlank
    @Size(max = 500)
    private String description;

    @NotNull
    @Positive
    private Integer value;
}
```

**ç‰¹å¾´**: ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…é ˆï¼ˆ`@NotNull`, `@NotBlank`ï¼‰

---

##### (2) æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Update{Aggregate}Request {
    @NotBlank
    private String name;

    @Size(max = 500)
    private String description;

    @Positive
    private Integer value;
}
```

**ç‰¹å¾´**: ID ã¯ URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å—ã‘å–ã‚‹ãŸã‚å«ã¾ãªã„

---

##### (3) éƒ¨åˆ†æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Patch{Aggregate}Request {
    // ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«
    @Size(min = 1, max = 100)
    private String name;

    @Size(max = 500)
    private String description;

    @Positive
    private Integer value;
}
```

**ç‰¹å¾´**: ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼ˆnull è¨±å®¹ï¼‰

---

### 3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTOï¼ˆResponse DTOï¼‰

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”å´ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¾ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

#### åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```java
/**
 * {Aggregate} ãƒ¬ã‚¹ãƒãƒ³ã‚¹
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class {Aggregate}Response {
    private Long id;
    private String name;
    private String description;
    private Integer value;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

#### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

1. **ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å«ã‚€**
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå¿…è¦ã¨ã™ã‚‹æƒ…å ±ã‚’ã™ã¹ã¦å«ã‚ã‚‹
   - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®å†…éƒ¨æ§‹é€ ã‚’éš è”½

2. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä¸è¦**
   - å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ãªã®ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä¸è¦
   - ã™ã§ã«ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§æ¤œè¨¼æ¸ˆã¿

3. **JSON ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¯¾å¿œ**
   - `@Data` ã§ getter ã‚’è‡ªå‹•ç”Ÿæˆ
   - Jackson ãŒè‡ªå‹•çš„ã« JSON ã«å¤‰æ›

---

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DTO ã®ç¨®é¡

##### (1) å˜ç´”ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class {Aggregate}Response {
    private Long id;
    private String name;
    private LocalDateTime createdAt;
}
```

---

##### (2) ãƒã‚¹ãƒˆã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class OrderResponse {
    private Long id;
    private CustomerResponse customer;  // ãƒã‚¹ãƒˆ
    private List<OrderItemResponse> items;  // ãƒªã‚¹ãƒˆ
    private BigDecimal totalAmount;
    private LocalDateTime createdAt;
}

@Data
@NoArgsConstructor
@AllArgsConstructor
public class CustomerResponse {
    private Long id;
    private String name;
    private String email;
}

@Data
@NoArgsConstructor
@AllArgsConstructor
public class OrderItemResponse {
    private Long productId;
    private String productName;
    private Integer quantity;
    private BigDecimal price;
}
```

---

### 4. ãƒãƒƒãƒ‘ãƒ¼ï¼ˆPresentation Mapperï¼‰

ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ãƒãƒƒãƒ‘ãƒ¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã® DTO ã¨ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã® DTO ã‚’å¤‰æ›ã—ã¾ã™ã€‚

#### MapStruct ã‚’ä½¿ç”¨ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³

```java
/**
 * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ DTO â†” ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ DTO ã®å¤‰æ›
 */
@Mapper(componentModel = "spring")
public interface {Aggregate}PresentationMapper {

    /**
     * ApplicationDTO â†’ Response
     */
    {Aggregate}Response toResponse({Aggregate}DTO dto);

    /**
     * ApplicationDTO ãƒªã‚¹ãƒˆ â†’ Response ãƒªã‚¹ãƒˆ
     */
    List<{Aggregate}Response> toResponseList(List<{Aggregate}DTO> dtos);

    /**
     * Request â†’ ApplicationDTOï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
     */
    {Aggregate}DTO toDTO(Create{Aggregate}Request request);
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãŒä¸€è‡´ã—ã¦ã„ã‚Œã°è‡ªå‹•ãƒãƒƒãƒ”ãƒ³ã‚°
- æ˜ç¤ºçš„ãª `@Mapping` ã¯ä¸è¦

---

## ğŸ” ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®è¨­è¨ˆåŸå‰‡

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã¸ã®ä¾å­˜ã®ã¿

âœ… **è‰¯ã„ä¾‹**: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ä¾å­˜

```java
@RestController
@RequiredArgsConstructor
public class Controller {
    private final CreateUseCase createUseCase;  // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤

    @PostMapping
    public ResponseEntity<Response> create(@RequestBody Request request) {
        DTO dto = createUseCase.execute(request);
        return ResponseEntity.ok(mapper.toResponse(dto));
    }
}
```

âŒ **æ‚ªã„ä¾‹**: ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã‚„ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã«ç›´æ¥ä¾å­˜

```java
@RestController
public class Controller {
    private final AggregateRepository repository;  // ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ç›´æ¥ä¾å­˜

    @PostMapping
    public ResponseEntity<Response> create(@RequestBody Request request) {
        Aggregate aggregate = Aggregate.create(...);
        repository.save(aggregate);  // NG
    }
}
```

---

### 2. HTTP é–¢å¿ƒã®åˆ†é›¢

âœ… **è‰¯ã„ä¾‹**: HTTP ã®é–¢å¿ƒã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«é–‰ã˜è¾¼ã‚ã‚‹

```java
@RestController
public class Controller {
    @GetMapping("/{id}")
    public ResponseEntity<Response> get(@PathVariable Long id) {
        DTO dto = getUseCase.execute(id);  // HTTP ã®æ¦‚å¿µãªã—
        return ResponseEntity.ok(mapper.toResponse(dto));
    }
}
```

âŒ **æ‚ªã„ä¾‹**: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã« HTTP ã®æ¦‚å¿µãŒæ¼ã‚Œã‚‹

```java
// ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ ResponseEntity ã‚’è¿”ã™ï¼ˆNGï¼‰
public ResponseEntity<DTO> execute(Long id) {
    // ...
    return ResponseEntity.ok(dto);
}
```

---

### 3. é©åˆ‡ãªHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä½¿ç”¨

```java
// 201 Created - ä½œæˆæˆåŠŸ
@PostMapping
public ResponseEntity<Response> create(...) {
    return ResponseEntity
        .created(URI.create("/api/resources/" + id))
        .body(response);
}

// 200 OK - å–å¾—ãƒ»æ›´æ–°æˆåŠŸ
@GetMapping("/{id}")
public ResponseEntity<Response> get(...) {
    return ResponseEntity.ok(response);
}

// 204 No Content - å‰Šé™¤æˆåŠŸï¼ˆãƒœãƒ‡ã‚£ãªã—ï¼‰
@DeleteMapping("/{id}")
public ResponseEntity<Void> delete(...) {
    return ResponseEntity.noContent().build();
}

// 400 Bad Request - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
// 404 Not Found - ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„
// 500 Internal Server Error - ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
```

---

### 4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿæ–½

âœ… **è‰¯ã„ä¾‹**: `@Valid` ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```java
@PostMapping
public ResponseEntity<Response> create(
    @RequestBody @Valid CreateRequest request  // @Valid ã§æ¤œè¨¼
) {
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã« 400 Bad Request ã«
    DTO dto = createUseCase.execute(request);
    return ResponseEntity.created(...).body(response);
}
```

---

## ğŸš€ å®Ÿè·µçš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```java
/**
 * ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
 */
@RestControllerAdvice
public class GlobalExceptionHandler {

    /**
     * ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„
     */
    @ExceptionHandler(NotFoundException.class)
    public ResponseEntity<ErrorResponse> handleNotFound(NotFoundException ex) {
        ErrorResponse error = new ErrorResponse(
            "NOT_FOUND",
            ex.getMessage(),
            LocalDateTime.now()
        );
        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
    }

    /**
     * ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ErrorResponse> handleValidation(
        MethodArgumentNotValidException ex
    ) {
        Map<String, String> errors = new HashMap<>();
        ex.getBindingResult().getFieldErrors().forEach(error ->
            errors.put(error.getField(), error.getDefaultMessage())
        );

        ErrorResponse errorResponse = new ErrorResponse(
            "VALIDATION_ERROR",
            "Invalid input",
            errors,
            LocalDateTime.now()
        );
        return ResponseEntity.badRequest().body(errorResponse);
    }

    /**
     * ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼
     */
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ErrorResponse> handleBusiness(BusinessException ex) {
        ErrorResponse error = new ErrorResponse(
            "BUSINESS_ERROR",
            ex.getMessage(),
            LocalDateTime.now()
        );
        return ResponseEntity.badRequest().body(error);
    }

    /**
     * äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼
     */
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGeneral(Exception ex) {
        ErrorResponse error = new ErrorResponse(
            "INTERNAL_ERROR",
            "An unexpected error occurred",
            LocalDateTime.now()
        );
        return ResponseEntity.internalServerError().body(error);
    }
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® DTO**:

```java
@Data
@AllArgsConstructor
public class ErrorResponse {
    private String code;
    private String message;
    private Object details;  // Map ã‚„ List ãªã©
    private LocalDateTime timestamp;

    public ErrorResponse(String code, String message, LocalDateTime timestamp) {
        this(code, message, null, timestamp);
    }
}
```

---

### 2. CORS è¨­å®š

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
            .allowedOrigins("http://localhost:3000")  // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®URL
            .allowedMethods("GET", "POST", "PUT", "DELETE", "PATCH")
            .allowedHeaders("*")
            .allowCredentials(true);
    }
}
```

---

### 3. OpenAPIï¼ˆSwaggerï¼‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

```java
@RestController
@RequestMapping("/api/films")
@Tag(name = "Films", description = "Film management APIs")
public class FilmsController {

    @Operation(
        summary = "Create a new film",
        description = "Creates a new film with the provided information"
    )
    @ApiResponses({
        @ApiResponse(
            responseCode = "201",
            description = "Film created successfully",
            content = @Content(schema = @Schema(implementation = FilmResponse.class))
        ),
        @ApiResponse(
            responseCode = "400",
            description = "Invalid input",
            content = @Content(schema = @Schema(implementation = ErrorResponse.class))
        )
    })
    @PostMapping
    public ResponseEntity<FilmResponse> create(
        @RequestBody @Valid CreateFilmRequest request
    ) {
        // ...
    }
}
```

---

## ğŸ“ ã¾ã¨ã‚

### ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

âœ… **REST API ã®æä¾›**

- HTTP ãƒ¡ã‚½ãƒƒãƒ‰ã¨ URL ã®è¨­è¨ˆ
- é©åˆ‡ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä½¿ç”¨

âœ… **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**

- `@Valid` ã«ã‚ˆã‚‹å…¥åŠ›æ¤œè¨¼
- Bean Validation ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®æ´»ç”¨

âœ… **ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**

- `@RestControllerAdvice` ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å‡¦ç†
- ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®çµ±ä¸€

âœ… **DTO ã®å¤‰æ›**

- Request â†’ Application DTO
- Application DTO â†’ Response

âœ… **ä¾å­˜é–¢ä¿‚ã®æ–¹å‘**

- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã«ä¾å­˜
- ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã«ã¯éä¾å­˜

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ.md](../ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ.md) - å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®èª¬æ˜
- [ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤.md](./ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤.md) - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®è©³ç´°
- [ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md](./ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤.md) - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…
- [ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤.md](./ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤.md) - ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…ã®è©³ç´°
